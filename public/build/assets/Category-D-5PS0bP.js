import"./base-F7uFyPqh.js";import{E as Oe}from"./el-overlay-Bj7qX_gB.js";import{E as Ue,a as Re}from"./el-col-B6vcNyhf.js";import{E as Ae}from"./el-pagination-14bCxj2f.js";import"./el-tag-CHIpI60o.js";import"./el-select-DAAqXABB.js";import"./el-scrollbar-CaHiQ2jM.js";import{E as Ge}from"./el-popper-ZONQKOcb.js";/* empty css                 *//* empty css                     */import{E as Ye,a as Se}from"./el-table-column-CFApD_Ao.js";import"./el-checkbox-WpBCvKce.js";import"./el-tooltip-l0sNRNKZ.js";import{E as ze}from"./el-popover-D-xYl_zR.js";import{E as Be}from"./el-button-Da-vKTsK.js";import{E as Fe,a as $e}from"./el-radio-B_BxKOU2.js";import{p as P,r as m,c as T,w as l,o as v,b as A,a,d as n,j as L,L as q,t as k,i as U,k as Z,u as ue,z,F as De}from"./app-8VsGFcX2.js";import{_ as Ie}from"./BackendLayout-CRbk2zI0.js";import"./index-TgJRFnZE.js";import{l as me}from"./vue-draggable-plus-CDtY5STC.js";/* empty css                        */import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Me}from"./index-B5Eq5iIq.js";import{E as je}from"./index-CBTzc5bQ.js";import{a as Pe,E as Le}from"./index-CsX1ZEWe.js";import"./vnode-O2VyULYN.js";import"./icon-DHQi6SUz.js";import"./refs-BvIol9SB.js";import"./index-Drrg9H66.js";import"./get-BfPBMtmL.js";import"./isArray-Dxzbedgu.js";import"./event-BB_Ol6Sd.js";import"./aria-C02hR53K.js";import"./use-form-common-props-CE_wdF9B.js";import"./index-CASUs_Ks.js";import"./typescript-Bp3YSIOJ.js";import"./isEqual-DFcmOf4i.js";import"./_Uint8Array-wIZ_amhJ.js";import"./index-BSNKJw_v.js";import"./castArray-Ce6QuK0j.js";import"./index-Cxidya-4.js";import"./index-CREfr6xS.js";import"./_initCloneObject-DQCSea_h.js";import"./el-main-Sz4hj5t3.js";import"./Header-LUJ3c-gi.js";import"./el-avatar--FhHPW_n.js";import"./index-l5omJr_w.js";import"./index-ChOKfouz.js";import"./_baseClone-BW0L-VQ6.js";const qe={class:"min-h-full"},Ze={style:{margin:"10px 0 15px"}},He={key:0},Je={key:0},Ke={key:0},Qe={key:1},We={class:"example-pagination-block"},Xe={key:0},el={key:0},ll={key:0},al={key:1},tl={key:0},ol={class:"new_sub_row"},sl={__name:"Category",props:{category:Object},setup(fe){const E=P({...fe.category});m(!1),m(!1);const pe=m(!1),_e=m(!1),i={CATEGORY:"cat",SUBCATEGORY:"sub"},$=m(!1),Q=m(),V=m(),W=m(null),ve=o=>{$.value=!$.value,Q.value="類別 : "+o.name,V.value=o.subcategories,W.value=o.id,oe()},G=m(!1),X=o=>{switch(o){case i.CATEGORY:Y.value=!Y.value;break;case i.SUBCATEGORY:G.value=!G.value;break}},ee=(o,e)=>{let s=e===i.SUBCATEGORY?V.value:E.data;const p=o.oldIndex,_=o.newIndex,r=Math.min(p,_),d=Math.max(p,_),f=s.slice(r,d+1);f.forEach((y,c)=>{y.order_index=r+c+1}),ge(f,e)},ge=async(o,e)=>{switch(e){case i.CATEGORY:try{const s=await z.post("/back/categories/reorder",o)}catch{}break;case i.SUBCATEGORY:try{const s=await z.post("/back/subcategories/reorder",o)}catch{}break}},Y=m(!1),R=m(!1),B=m(!1),w=m(null),b=m(null),h=m({}),O=m({}),le=async(o,e)=>{(e===i.CATEGORY?b.value===o.id:w.value===o.id)?await ce(o,e):we(o,e)},ce=async(o,e)=>{try{switch(e){case i.CATEGORY:await ae(O.value,o,e);break;case i.SUBCATEGORY:await ae(h.value,o,e);break}}catch{}},we=(o,e)=>{switch(e){case i.CATEGORY:b.value=o.id,O.value={...o};break;case i.SUBCATEGORY:w.value=o.id,h.value={...o};break}},ae=async(o,e,s)=>{var p,_;switch(s){case i.CATEGORY:try{if(!Object.keys(o).some(c=>o[c]!==e[c])){b.value=null;return}await J(ne);let d={name:o.name,search_key:o.search_key,show_in_list:o.show_in_list,order_index:o.order_index},f=o.id;if((await z.patch(`/back/categories/${f}`,d,{validateStatus:c=>c<400})).data){Object.assign(e,o),b.value=null,g("success","保存成功");return}else throw g("error","保存失敗"),new Error("保存失敗")}catch(r){if(r.response&&r.response.status===403){const d=((p=r.response.data)==null?void 0:p.message)||"保存失敗";g("warning",d);return}g("error","保存失敗")}break;case i.SUBCATEGORY:try{if(!Object.keys(o).some(c=>o[c]!==e[c])){w.value=null;return}await J(re);let d=e.id,f={category_id:o.category_id,name:o.name,search_key:o.search_key,show_in_list:o.show_in_list,order_index:o.order_index};if((await z.post(`/back/subcategories/${d}/update_sub`,f,{validateStatus:c=>c<400})).data){Object.assign(e,o),w.value=null,g("success","保存成功");return}else throw g("error","保存失敗"),new Error("保存失敗")}catch(r){if(r.response&&r.response.status===403){const d=((_=r.response.data)==null?void 0:_.message)||"保存失敗";g("warning",d);return}g("error","保存失敗")}break}},te=async(o,e)=>{var s;try{const{url:p,list:_,setList:r,errorMessages:d}=ye(e),f=await z.delete(`${p}/${o}`);f.data.message==="success"?(r(_.filter(y=>y.id!==o)),g("success","刪除成功")):f.data.message===d.exist?g("error","關聯之子類別尚存在"):g("error","刪除失敗")}catch(p){if(p.response&&p.response.status===403){const _=((s=p.response.data)==null?void 0:s.message)||"刪除失敗";g("warning",_);return}g("error","刪除失敗")}},ye=o=>{switch(o){case i.CATEGORY:return{url:"/back/categories",list:E.data,setList:e=>E.data=e,errorMessages:{exist:"subcategory exist"}};case i.SUBCATEGORY:return{url:"/back/subcategories",list:V.value,setList:e=>V.value=e,errorMessages:{}};default:throw new Error("未知的刪除類型")}},ke=()=>{w.value=null},C=P({name:"",search_key:"",show_in_list:"",order_index:""}),H=m("top"),be=()=>{const o=V.value.length>0?Math.max(...V.value.map(e=>e.order_index)):0;Object.assign(C,{name:"",search_key:"",show_in_list:1,order_index:o+1}),R.value=!R.value,B.value=!B.value},oe=()=>{B.value=null,R.value=!1,I.value&&I.value.resetFields()},S=m(!1),Ce=()=>{S.value=!S.value,N.value&&N.value.resetFields()},se=async o=>{var e;try{const s=o===i.CATEGORY,p=s?N:I,_=s?{name:x.name,search_key:x.search_key,show_in_list:x.show_in_list}:{name:C.name,search_key:C.search_key,show_in_list:C.show_in_list},r=s?"/back/categories":`/back/categories/${W.value}/subcategories`,d=s?E.data:V.value;await J(p);const f=await z.post(r,_,{validateStatus:c=>c<400}),y=s?f.data:f.data.data;y?(d.push(y),s?S.value=!1:(B.value=null,R.value=!R.value),g("success","新增成功")):g("error","新增失敗")}catch(s){if(s.response&&s.response.status===403){const p=((e=s.response.data)==null?void 0:e.message)||"新增失敗";g("warning",p);return}g("error","新增失敗")}},Ee=()=>{b.value=null},D=m({}),g=(o,e)=>{Me({type:o,title:e,position:"bottom-left"})},I=m(null),N=m(null),re=m(null),ne=m(null),x=P({name:"",search_key:"",show_in_list:"",order_index:""}),Ve=()=>{S.value=!1},M=P({name:[{required:!0,message:"子類別名稱為必填項",trigger:"blur"}],search_key:[{required:!0,message:"索引名稱為必填項",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"索引名稱只能包含字母、數字或底線",trigger:"change"}],show_in_list:[{required:!0,message:"必須選擇顯示/隱藏",trigger:"change"}]}),J=o=>new Promise((e,s)=>{o.value?o.value.validate(p=>{p?e(!0):s(!1)}):s(new Error("未綁定"))});function xe(o){o=data.current_page,De.get("/back/categories",{page:o})}return(o,e)=>{const s=Be,p=Ge,_=je,r=Pe,d=Ye,f=Fe,y=$e,c=ze,ie=Se,j=Le,Te=Ae,F=Ue,he=Re,de=Oe;return v(),T(Ie,null,{switch:l(()=>[A("div",qe,[A("div",Ze,[a(s,{onClick:Ce},{default:l(()=>e[23]||(e[23]=[n("添加類別")])),_:1}),a(p,{class:"box-item",effect:"dark",content:Y.value===!1?"進行拖曳表格調整":"結束拖曳表格調整",placement:"top-start"},{default:l(()=>[L(a(s,{onClick:e[0]||(e[0]=t=>X(i.CATEGORY)),type:Y.value===!1?"":"primary"},{default:l(()=>[n(k(Y.value===!1?"調整順序":"退出調整"),1)]),_:1},8,["type"]),[[q,!R.value]])]),_:1},8,["content"])]),a(ue(me),{modelValue:E.data,"onUpdate:modelValue":e[4]||(e[4]=t=>E.data=t),target:"tbody",onEnd:e[5]||(e[5]=t=>ee(t,i.CATEGORY)),animation:150,ghostClass:"ghost",disabled:!Y.value},{default:l(()=>[a(j,{model:O.value,rules:M,ref_key:"cgFormRef",ref:ne},{default:l(()=>[a(ie,{data:E.data,style:{width:"100%"},border:""},{default:l(()=>[a(d,{width:"220",fixed:_e.value?"left":!1,prop:"name"},{header:l(()=>e[24]||(e[24]=[n(" 類別名稱 ")])),default:l(t=>[b.value!==t.row.id?(v(),U("div",He,k(t.row.name),1)):(v(),T(r,{key:1,prop:"name"},{default:l(()=>[a(_,{modelValue:O.value.name,"onUpdate:modelValue":e[1]||(e[1]=u=>O.value.name=u),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1},8,["fixed"]),a(d,{prop:"search_key",label:"類別索引"},{header:l(()=>e[25]||(e[25]=[n(" 類別索引 ")])),default:l(t=>[b.value!==t.row.id?(v(),U("div",Je,k(t.row.search_key),1)):(v(),T(r,{key:1,prop:"search_key"},{default:l(()=>[a(_,{modelValue:O.value.search_key,"onUpdate:modelValue":e[2]||(e[2]=u=>O.value.search_key=u),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1}),a(d,{prop:"order_index",label:"順序"}),a(d,{prop:"show_in_list",label:"顯示 / 隱藏"},{default:l(t=>[b.value!==t.row.id?(v(),U("div",Ke,k(t.row.show_in_list==1?"顯示":"隱藏"),1)):(v(),U("div",Qe,[a(r,null,{default:l(()=>[a(y,{modelValue:O.value.show_in_list,"onUpdate:modelValue":e[3]||(e[3]=u=>O.value.show_in_list=u)},{default:l(()=>[a(f,{value:1},{default:l(()=>e[26]||(e[26]=[n("顯示")])),_:1}),a(f,{value:0},{default:l(()=>e[27]||(e[27]=[n("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1})]))]),_:1}),a(d,{width:"140",fixed:pe.value?"right":!1},{header:l(()=>e[28]||(e[28]=[A("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[A("span",null,"子類別")],-1)])),default:l(t=>[a(s,{type:"primary",text:"",onClick:u=>ve(t.row)},{default:l(()=>e[29]||(e[29]=[n("查看")])),_:2},1032,["onClick"])]),_:1},8,["fixed"]),a(d,{label:"操作",width:"200"},{default:l(t=>[a(s,{type:b.value===t.row.id?"primary":"",size:"small",onClick:u=>le(t.row,i.CATEGORY)},{default:l(()=>[n(k(b.value===t.row.id?"儲存":"編輯"),1)]),_:2},1032,["type","onClick"]),b.value===t.row.id?(v(),T(s,{key:0,size:"small",onClick:Ee},{default:l(()=>e[30]||(e[30]=[n(" 取消 ")])),_:1})):Z("",!0),b.value!==t.row.id?(v(),T(c,{key:1,title:"確定移除此筆資料?",onConfirm:u=>te(t.row.id,i.CATEGORY),width:170,"hide-after":100,visible:D.value[t.row.id],"onUpdate:visible":u=>D.value[t.row.id]=u},{reference:l(()=>[a(s,{size:"small",type:"danger"},{default:l(()=>e[31]||(e[31]=[n("移除")])),_:1})]),actions:l(({confirm:u,cancel:K})=>[a(s,{size:"small",onClick:K},{default:l(()=>e[32]||(e[32]=[n("沒有")])),_:2},1032,["onClick"]),a(s,{type:"danger",size:"small",onClick:u},{default:l(()=>e[33]||(e[33]=[n(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])):Z("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","disabled"]),A("div",We,[e[34]||(e[34]=A("div",{class:"example-demonstration"},null,-1)),a(Te,{layout:"prev, pager, next",total:E.total,"page-size":E.per_page,"current-page":E.current_page,"onUpdate:currentPage":e[6]||(e[6]=t=>E.current_page=t),onCurrentChange:xe,background:""},null,8,["total","page-size","current-page"])])]),a(de,{modelValue:$.value,"onUpdate:modelValue":e[17]||(e[17]=t=>$.value=t),title:Q.value,width:"1000px"},{default:l(()=>[a(ue(me),{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t),target:"tbody",onEnd:e[11]||(e[11]=t=>ee(t,i.SUBCATEGORY)),animation:150,ghostClass:"ghost",disabled:!G.value},{default:l(()=>[a(j,{model:h.value,rules:M,ref_key:"subFormRef",ref:re},{default:l(()=>[a(ie,{data:V.value,style:{width:"100%"}},{default:l(()=>[a(d,{label:"子類別名稱",width:"220"},{default:l(t=>[w.value!==t.row.id?(v(),U("div",Xe,k(t.row.name),1)):(v(),T(r,{key:1,prop:"name"},{default:l(()=>[a(_,{modelValue:h.value.name,"onUpdate:modelValue":e[7]||(e[7]=u=>h.value.name=u),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1}),a(d,{label:"索引名稱",width:"220"},{default:l(t=>[w.value!==t.row.id?(v(),U("div",el,k(t.row.search_key),1)):(v(),T(r,{key:1,prop:"search_key"},{default:l(()=>[a(_,{modelValue:h.value.search_key,"onUpdate:modelValue":e[8]||(e[8]=u=>h.value.search_key=u),placeholder:"輸入索引名稱",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1}),a(d,{label:"顯示 / 隱藏",width:"220"},{default:l(t=>[w.value!==t.row.id?(v(),U("div",ll,k(t.row.show_in_list==1?"顯示":"隱藏"),1)):(v(),U("div",al,[a(r,null,{default:l(()=>[a(y,{modelValue:h.value.show_in_list,"onUpdate:modelValue":e[9]||(e[9]=u=>h.value.show_in_list=u)},{default:l(()=>[a(f,{value:1},{default:l(()=>e[35]||(e[35]=[n("顯示")])),_:1}),a(f,{value:0},{default:l(()=>e[36]||(e[36]=[n("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1})]))]),_:1}),a(d,{label:"順序",width:"108"},{default:l(t=>[w.value!==t.row.id?(v(),U("div",tl,k(t.row.order_index),1)):(v(),T(r,{key:1},{default:l(()=>[n(k(t.row.order_index),1)]),_:2},1024))]),_:1}),a(d,{label:"操作",width:"200"},{default:l(t=>[a(s,{type:w.value===t.row.id?"primary":"",size:"small",onClick:u=>le(t.row,i.SUBCATEGORY)},{default:l(()=>[n(k(w.value===t.row.id?"儲存":"編輯"),1)]),_:2},1032,["type","onClick"]),w.value===t.row.id?(v(),T(s,{key:0,size:"small",onClick:ke},{default:l(()=>e[37]||(e[37]=[n(" 取消 ")])),_:1})):Z("",!0),w.value!==t.row.id?(v(),T(c,{key:1,title:"確定移除此筆資料?",onConfirm:u=>te(t.row.id,i.SUBCATEGORY),width:170,"hide-after":100,visible:D.value[t.row.id],"onUpdate:visible":u=>D.value[t.row.id]=u},{reference:l(()=>[a(s,{size:"small",type:"danger"},{default:l(()=>e[38]||(e[38]=[n("移除")])),_:1})]),actions:l(({confirm:u,cancel:K})=>[a(s,{size:"small",onClick:K},{default:l(()=>e[39]||(e[39]=[n("沒有")])),_:2},1032,["onClick"]),a(s,{type:"danger",size:"small",onClick:u},{default:l(()=>e[40]||(e[40]=[n(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])):Z("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","disabled"]),L(A("div",ol,[a(j,{model:C,rules:M,ref_key:"newSubFormRef",ref:I},{default:l(()=>[a(he,{class:"new_sub_form_row"},{default:l(()=>[a(F,null,{default:l(()=>[a(r,{prop:"name"},{default:l(()=>[a(_,{modelValue:C.name,"onUpdate:modelValue":e[12]||(e[12]=t=>C.name=t),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(r,{prop:"search_key"},{default:l(()=>[a(_,{modelValue:C.search_key,"onUpdate:modelValue":e[13]||(e[13]=t=>C.search_key=t),placeholder:"輸入索引名稱",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(r,null,{default:l(()=>[a(y,{modelValue:C.show_in_list,"onUpdate:modelValue":e[14]||(e[14]=t=>C.show_in_list=t)},{default:l(()=>[a(f,{value:1},{default:l(()=>e[41]||(e[41]=[n("顯示")])),_:1}),a(f,{value:0},{default:l(()=>e[42]||(e[42]=[n("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(r,null,{default:l(()=>[n(k(C.order_index),1)]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(r,null,{default:l(()=>[a(s,{size:"small",type:"success",onClick:e[15]||(e[15]=t=>se(i.SUBCATEGORY))},{default:l(()=>e[43]||(e[43]=[n(" 新增 ")])),_:1}),a(s,{size:"small",onClick:oe},{default:l(()=>e[44]||(e[44]=[n(" 取消 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])],512),[[q,B.value]]),L(a(s,{style:{margin:"10px 0"},onClick:be},{default:l(()=>e[45]||(e[45]=[n("添加子類別")])),_:1},512),[[q,!R.value]]),a(p,{class:"box-item",effect:"dark",content:G.value===!1?"進行拖曳表格調整":"結束拖曳表格調整",placement:"top-start"},{default:l(()=>[L(a(s,{style:{margin:"10px"},onClick:e[16]||(e[16]=t=>X(i.SUBCATEGORY)),type:G.value===!1?"":"primary"},{default:l(()=>[n(k(G.value===!1?"調整順序":"退出調整"),1)]),_:1},8,["type"]),[[q,!R.value]])]),_:1},8,["content"])]),_:1},8,["modelValue","title"]),a(de,{modelValue:S.value,"onUpdate:modelValue":e[22]||(e[22]=t=>S.value=t),title:"新增類別",width:"400px"},{footer:l(()=>[a(s,{type:"primary",onClick:e[21]||(e[21]=t=>se(i.CATEGORY))},{default:l(()=>e[48]||(e[48]=[n("提交")])),_:1}),a(s,{onClick:Ve},{default:l(()=>e[49]||(e[49]=[n("取消")])),_:1})]),default:l(()=>[a(j,{model:x,class:"demo-ruleForm",rules:M,ref_key:"newCgFormRef",ref:N},{default:l(()=>[a(r,{label:"類別名稱","label-position":H.value,prop:"name"},{default:l(()=>[a(_,{modelValue:x.name,"onUpdate:modelValue":e[18]||(e[18]=t=>x.name=t)},null,8,["modelValue"])]),_:1},8,["label-position"]),a(r,{label:"索引名稱","label-position":H.value,prop:"search_key"},{default:l(()=>[a(_,{modelValue:x.search_key,"onUpdate:modelValue":e[19]||(e[19]=t=>x.search_key=t)},null,8,["modelValue"])]),_:1},8,["label-position"]),a(r,{label:"顯示 / 隱藏","label-position":H.value,prop:"show_in_list"},{default:l(()=>[a(y,{modelValue:x.show_in_list,"onUpdate:modelValue":e[20]||(e[20]=t=>x.show_in_list=t)},{default:l(()=>[a(f,{value:1},{default:l(()=>e[46]||(e[46]=[n("顯示")])),_:1}),a(f,{value:0},{default:l(()=>e[47]||(e[47]=[n("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-position"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1})}}},aa=Ne(sl,[["__scopeId","data-v-6353a261"]]);export{aa as default};
