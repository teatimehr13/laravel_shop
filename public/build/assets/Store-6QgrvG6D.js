import{b as $e,u as Ae,_ as Ie,c as Me,w as ze}from"./base-F7uFyPqh.js";import{v as He}from"./el-loading-CkYfXaHa.js";import{E as Oe}from"./el-overlay-Bj7qX_gB.js";import{E as Ke,a as je}from"./el-table-column-CFApD_Ao.js";import{E as We}from"./el-checkbox-WpBCvKce.js";import"./el-tooltip-l0sNRNKZ.js";import{b as ne,u as k,E as ve}from"./el-popper-ZONQKOcb.js";import"./el-scrollbar-CaHiQ2jM.js";import{E as Ye}from"./el-popover-D-xYl_zR.js";import{E as qe}from"./el-button-Da-vKTsK.js";/* empty css                     */import"./el-tag-CHIpI60o.js";/* empty css                 */import{E as Xe,a as Ge}from"./el-select-DAAqXABB.js";import{av as Je,C as be,f as R,r as n,u as m,R as Qe,o as x,c as X,w as s,i as G,n as ge,t as ie,k as J,A as pe,d as w,a4 as Ze,y as et,p as W,z as I,g as de,aw as tt,b as C,a as l,O as ot,N as at,P as rt,j as lt,W as ue,X as st}from"./app-8VsGFcX2.js";import{_ as nt}from"./BackendLayout-CRbk2zI0.js";import me from"./StoreForm-Dl6un-UQ.js";import{d as fe}from"./index-TgJRFnZE.js";/* empty css                        */import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as pt}from"./el-progress-CqvdZqzC.js";import{E as Y}from"./index-B5Eq5iIq.js";import{E as dt}from"./index-CBTzc5bQ.js";import{a as ut}from"./index-CsX1ZEWe.js";import{d as q}from"./el-avatar--FhHPW_n.js";import"./aria-C02hR53K.js";import"./index-Drrg9H66.js";import"./get-BfPBMtmL.js";import"./isArray-Dxzbedgu.js";import"./use-form-common-props-CE_wdF9B.js";import"./index-CASUs_Ks.js";import"./vnode-O2VyULYN.js";import"./icon-DHQi6SUz.js";import"./refs-BvIol9SB.js";import"./event-BB_Ol6Sd.js";import"./_Uint8Array-wIZ_amhJ.js";import"./index-BSNKJw_v.js";import"./_initCloneObject-DQCSea_h.js";import"./isEqual-DFcmOf4i.js";import"./index-CREfr6xS.js";import"./castArray-Ce6QuK0j.js";import"./index-Cxidya-4.js";import"./el-main-Sz4hj5t3.js";import"./Header-LUJ3c-gi.js";import"./el-col-B6vcNyhf.js";import"./typescript-Bp3YSIOJ.js";import"./index-l5omJr_w.js";import"./el-radio-B_BxKOU2.js";import"./_baseClone-BW0L-VQ6.js";import"./index-ChOKfouz.js";const mt=$e({trigger:ne.trigger,placement:q.placement,disabled:ne.disabled,visible:k.visible,transition:k.transition,popperOptions:q.popperOptions,tabindex:q.tabindex,content:k.content,popperStyle:k.popperStyle,popperClass:k.popperClass,enterable:{...k.enterable,default:!0},effect:{...k.effect,default:"light"},teleported:k.teleported,title:String,width:{type:[String,Number],default:150},offset:{type:Number,default:void 0},showAfter:{type:Number,default:0},hideAfter:{type:Number,default:200},autoClose:{type:Number,default:0},showArrow:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},"onUpdate:visible":{type:Function}}),ft={"update:visible":g=>Je(g),"before-enter":()=>!0,"before-leave":()=>!0,"after-enter":()=>!0,"after-leave":()=>!0},ct="onUpdate:visible",vt=be({name:"ElPopover"}),bt=be({...vt,props:mt,emits:ft,setup(g,{expose:c,emit:_}){const o=g,d=R(()=>o[ct]),y=Ae("popover"),h=n(),F=R(()=>{var r;return(r=m(h))==null?void 0:r.popperRef}),P=R(()=>[{width:Qe(o.width)},o.popperStyle]),T=R(()=>[y.b(),o.popperClass,{[y.m("plain")]:!!o.content}]),D=R(()=>o.transition===`${y.namespace.value}-fade-in-linear`),N=()=>{var r;(r=h.value)==null||r.hide()},B=()=>{_("before-enter")},M=()=>{_("before-leave")},z=()=>{_("after-enter")},S=()=>{_("update:visible",!1),_("after-leave")};return c({popperRef:F,hide:N}),(r,Q)=>(x(),X(m(ve),Ze({ref_key:"tooltipRef",ref:h},r.$attrs,{trigger:r.trigger,placement:r.placement,disabled:r.disabled,visible:r.visible,transition:r.transition,"popper-options":r.popperOptions,tabindex:r.tabindex,content:r.content,offset:r.offset,"show-after":r.showAfter,"hide-after":r.hideAfter,"auto-close":r.autoClose,"show-arrow":r.showArrow,"aria-label":r.title,effect:r.effect,enterable:r.enterable,"popper-class":m(T),"popper-style":m(P),teleported:r.teleported,persistent:r.persistent,"gpu-acceleration":m(D),"onUpdate:visible":m(d),onBeforeShow:B,onBeforeHide:M,onShow:z,onHide:S}),{content:s(()=>[r.title?(x(),G("div",{key:0,class:ge(m(y).e("title")),role:"title"},ie(r.title),3)):J("v-if",!0),pe(r.$slots,"default",{},()=>[w(ie(r.content),1)])]),default:s(()=>[r.$slots.reference?pe(r.$slots,"reference",{key:0}):J("v-if",!0)]),_:3},16,["trigger","placement","disabled","visible","transition","popper-options","tabindex","content","offset","show-after","hide-after","auto-close","show-arrow","aria-label","effect","enterable","popper-class","popper-style","teleported","persistent","gpu-acceleration","onUpdate:visible"]))}});var gt=Ie(bt,[["__file","popover.vue"]]);const ce=(g,c)=>{const _=c.arg||c.value,o=_==null?void 0:_.popperRef;o&&(o.triggerRef=g)};var _t={mounted(g,c){ce(g,c)},updated(g,c){ce(g,c)}};const yt="popover",wt=Me(_t,yt),ht=ze(gt,{directive:wt}),kt={class:"filters"},Ct={style:{display:"flex","align-items":"center",gap:"8px"}},Et=["src"],St=["innerHTML"],Ut={style:{display:"flex","align-items":"center",gap:"8px"}},Vt={__name:"Store",setup(g){et(()=>{N(),Se()});const c=t=>{u.value=t},_=[{name:"全部類型",value:""},{name:"直營",value:"0"},{name:"特約展售",value:"1"},{name:"授權經銷商",value:"2"}],o=W({store_name:"",store_type:"",address:"",contact_number:"",opening_hours:""}),d=W({data:[],current_page:1,last_page:null}),y=n(!1),h=n(!1),F=n(""),P=n(""),T=n(!1),D=n(!1),N=fe(async()=>{if(!(y.value||h.value)){y.value=!0;try{const t=await I.get("/back/stores",{params:{page:d.current_page,store_type:F.value||null,address:P.value||null}}),e=t.data.data,i=t.data.last_page;e.length>0?(d.data.push(...e),d.current_page+=1,d.last_page=i,d.current_page>d.last_page&&(h.value=!0)):h.value=!0}catch{}finally{y.value=!1}}},300),B=fe(()=>{d.data=[],d.current_page=1,h.value=!1,N()},500),M=R(()=>d.data?d.data.map(t=>t.opening_hours?t.opening_hours.split(`
`).map(e=>e.trim()).filter(e=>e!=="").join("<br>"):""):""),z=({row:t})=>U.value===t.id?"activeRowFocus":"",S=W({}),r=n("left-start"),Q=n(null),_e=n({});n("default");let ye=n(8);const we=n({height:"550px",overflowX:"hidden",overflowY:"auto"}),Z=t=>{S[t]=!1},U=n(null),he=t=>{setTimeout(()=>{L.value=t.image?[{name:t.store_name,url:t.image,uid:pt()}]:[],u.value=[{delete_image:!1}],o.is_enabled=parseInt(t.is_enabled),o.id=t.id,o.store_name=t.store_name,o.store_type=parseInt(t.store_type),o.address=t.address,o.image=t.image,o.contact_number=t.contact_number,o.opening_hours=t.opening_hours?t.opening_hours.split(`
`).map(e=>e.trim()).filter(e=>e!=="").join(`
`):""},100)},ke=t=>{Ce()},Ce=()=>{const t=document.querySelector(".el-scrollbar__wrap");t&&(t.style.overflowY="hidden")},Ee=()=>{const t=document.querySelector(".el-scrollbar__wrap");t&&(t.style.overflowY="auto")},Se=()=>{const t=document.createElement("style");t.type="text/css",t.innerHTML=`
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #d3d3d3;
      border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #b3b3b3; /* 滾動條懸停顏色 */
    }
  `,document.head.appendChild(t)};n("");const V=n(!1),ee=()=>{V.value=!V.value,Ue()},H=()=>{Y({title:"操作成功",type:"success",position:"bottom-left"})},$=(t="操作失敗")=>{Y({title:t,type:"error",position:"bottom-left"})},L=n([]);let u=n([]);const O=n(null),te=n(null),oe=t=>{switch(t){case"edit":return te.value.formValidate();case"add":return O.value.formValidate()}},Ue=()=>{st(()=>{O.value.internalFormRef.resetFields(),o.store_name="",o.store_type="",o.address="",o.contact_number="",o.opening_hours="",o.is_enabled="",L.value=[],u.value=[]})};let f=new FormData;const ae=()=>{if(f=new FormData,f.append("store_name",o.store_name),f.append("store_type",o.store_type),f.append("address",o.address),f.append("contact_number",o.contact_number),f.append("opening_hours",o.opening_hours),f.append("is_enabled",o.is_enabled),f.append("id",o.id),u.value.length>0){const t=u.value[0];t.raw&&f.append("image",t.raw)}else f.append("delete_image",!0)},K=n({}),re=async()=>{var t;try{await oe("edit"),await ae();const i=(await I.post("/back/stores/update_stores",f,{headers:{"Content-Type":"multipart/form-data"},validateStatus:v=>v<400})).data;if(i){const v=d.data.findIndex(A=>A.id===i.id);v!==-1&&(d.data[v]=i),Z(o.id),H();return}$()}catch(e){if(e.response&&e.response.status===403){const i=((t=e.response.data)==null?void 0:t.message)||"提交失敗";j("warning",i);return}}},Ve=async()=>{var t;try{if(await oe("add"),await ae(),(await I.post("/back/stores",f,{headers:{"Content-Type":"multipart/form-data"},validateStatus:v=>v<400})).data){V.value=!V.value,H();return}$()}catch(e){if(e.response&&e.response.status===403){const i=((t=e.response.data)==null?void 0:t.message)||"提交失敗";j("warning",i);return}$()}},Le=async t=>{var e;try{let i={id:t};if((await I.post("/back/stores/delete_stores",i,{headers:{"Content-Type":"multipart/form-data"}})).data.success){d.data=d.data.filter(b=>b.id!==t),H();return}$()}catch(i){if(i.response&&i.response.status===403){const v=((e=i.response.data)==null?void 0:e.message)||"提交失敗";j("warning",v);return}}};de(S,t=>{for(const e in t)if(t[e]){U.value=Number(e);return}U.value=""},{deep:!0}),de(K,t=>{for(const e in t)if(t[e]){U.value=Number(e);return}U.value=""},{deep:!0});const j=(t,e)=>{Y({type:t,title:e,position:"bottom-left"})};return(t,e)=>{const i=Xe,v=Ge,A=dt,b=qe,le=We,se=ve,E=Ke,Re=ut,xe=ht,Fe=Ye,Pe=je,Te=Oe,De=tt("el-table-infinite-scroll"),Ne=He;return x(),X(nt,null,{switch:s(()=>[C("div",null,[C("div",kt,[l(v,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=a=>F.value=a),placeholder:"全部類型",style:{width:"150px"},onChange:m(B)},{default:s(()=>[(x(),G(at,null,ot(_,a=>l(i,{key:a.value,label:a.name,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onChange"]),l(A,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),placeholder:"輸入地址篩選",style:{width:"240px"},onKeyup:rt(m(B),["enter"])},null,8,["modelValue","onKeyup"])]),l(b,{type:"",onClick:ee,style:{margin:"10px 0"}},{default:s(()=>e[11]||(e[11]=[w("新增門市")])),_:1}),C("div",null,[lt((x(),X(Pe,{data:d.data,style:{width:"100%",height:"calc(100vh - 250px)"},"infinite-scroll-disabled":y.value,"element-loading-text":"加載中...","row-class-name":z,border:""},{default:s(()=>[l(E,{fixed:D.value?"left":!1,prop:"store_name"},{header:s(()=>[C("div",Ct,[e[12]||(e[12]=C("span",null,"門市名稱",-1)),l(se,{content:"固定/取消固定門市列"},{default:s(()=>[l(le,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=a=>D.value=a)},null,8,["modelValue"])]),_:1})])]),_:1},8,["fixed"]),l(E,{label:"圖片"},{default:s(a=>[a.row.image?(x(),G("img",{key:0,src:a.row.image,alt:"店面圖片",style:{"max-width":"75px","border-radius":"4px"}},null,8,Et)):J("",!0)]),_:1}),l(E,{prop:"store_type_name",label:"類型"}),l(E,{prop:"address",label:"地址"}),l(E,{prop:"contact_number",label:"聯絡電話"}),l(E,{prop:"opening_hours",label:"營業時間"},{default:s(a=>[C("div",{innerHTML:M.value[a.$index]},null,8,St)]),_:1}),l(E,{fixed:T.value?"right":!1},{header:s(()=>[C("div",Ut,[e[13]||(e[13]=C("span",null,"操作",-1)),l(se,{content:"固定/取消固定操作列"},{default:s(()=>[l(le,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=a=>T.value=a)},null,8,["modelValue"])]),_:1})])]),default:s(a=>[l(xe,{placement:r.value,trigger:"click",width:350,visible:S[a.row.id],"onUpdate:visible":p=>S[a.row.id]=p,"popper-class":"custom-scrollbar","hide-after":0,"show-after":100,onShow:p=>ke(a.row.id),"popper-style":we.value,onBeforeLeave:Ee,offset:m(ye),ref_key:"popoverRef",ref:Q},{reference:s(()=>[l(b,{size:"small",onClick:p=>he(a.row),ref:p=>_e.value[a.row.id]=p,class:ge({activeButton:U.value===a.row.id})},{default:s(()=>e[14]||(e[14]=[w("編輯")])),_:2},1032,["onClick","class"])]),default:s(()=>[l(me,{"file-list":L.value,"onUpdate:fileList":e[4]||(e[4]=p=>L.value=p),"form-data":o,"onUpdate:formData":e[5]||(e[5]=p=>o=p),onSubmit:re,uploadList:m(u),"onUpdate:uploadList":e[6]||(e[6]=p=>ue(u)?u.value=p:u=p),ref_key:"formRef2",ref:te,onUploadList:c},null,8,["file-list","form-data","uploadList"]),l(Re,null,{default:s(()=>[l(b,{type:"primary",onClick:re},{default:s(()=>e[15]||(e[15]=[w("儲存")])),_:1}),l(b,{onClick:p=>Z(a.row.id)},{default:s(()=>e[16]||(e[16]=[w("關閉")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["placement","visible","onUpdate:visible","onShow","popper-style","offset"]),l(Fe,{title:"確定移除此筆資料?",onConfirm:p=>Le(a.row.id),width:170,"hide-after":100,visible:K.value[a.row.id],"onUpdate:visible":p=>K.value[a.row.id]=p},{reference:s(()=>[l(b,{size:"small",type:"danger"},{default:s(()=>e[17]||(e[17]=[w("移除")])),_:1})]),actions:s(({confirm:p,cancel:Be})=>[l(b,{size:"small",onClick:Be},{default:s(()=>e[18]||(e[18]=[w("沒有")])),_:2},1032,["onClick"]),l(b,{type:"danger",size:"small",onClick:p},{default:s(()=>e[19]||(e[19]=[w(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])]),_:1},8,["fixed"])]),_:1},8,["data","infinite-scroll-disabled"])),[[De,m(N)],[Ne,y.value]])])]),l(Te,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),title:"新增",width:"400px"},{footer:s(()=>[l(b,{type:"primary",onClick:Ve},{default:s(()=>e[20]||(e[20]=[w("提交")])),_:1}),l(b,{onClick:ee},{default:s(()=>e[21]||(e[21]=[w("取消")])),_:1})]),default:s(()=>[l(me,{"form-data":o,"onUpdate:formData":e[7]||(e[7]=a=>o=a),"file-list":L.value,"onUpdate:fileList":e[8]||(e[8]=a=>L.value=a),"upload-list":m(u),"onUpdate:uploadList":e[9]||(e[9]=a=>ue(u)?u.value=a:u=a),onUploadList:c,ref_key:"formRef",ref:O},null,8,["form-data","file-list","upload-list"])]),_:1},8,["modelValue"])]),_:1})}}},So=it(Vt,[["__scopeId","data-v-5e054b39"]]);export{So as default};
