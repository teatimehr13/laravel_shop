import{b as le,u as oe,E as ie,_ as se,w as re}from"./base-iHJmQtcg.js";/* empty css                     */import{E as ne}from"./el-date-picker-FaBY5tv7.js";/* empty css                 */import"./el-scrollbar-BLZesUDu.js";import{E as de}from"./el-popper-CJSoZX_d.js";import{E as me}from"./el-button-CQNoZzvE.js";import"./el-tooltip-l0sNRNKZ.js";import{E as ue}from"./el-overlay-CtzYCaxC.js";import{g as pe,E as fe}from"./el-progress-Bfxy5kti.js";import{E as ce,a as ge}from"./el-radio-1sMkJyS3.js";import"./el-tag-CPuyrTQm.js";import{E as be,a as ve}from"./el-select-7TH_FEuU.js";import{C as Q,f as De,o as p,i as _,c as y,w as s,q as _e,u as c,k as F,n as T,A as B,a7 as ye,r as u,p as Ee,h as Ve,a as o,N,O,d as k,b as h,t as ke,a8 as R,j as S,L as q,z as he}from"./app-JKzr_vVp.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as we,a as Ce}from"./index-DJdM4qGV.js";import{E as Ue}from"./index-CcXRvPvX.js";import{i as Le}from"./icon-MSFJ_NKx.js";import"./dayjs.min-Dd8mipII.js";import"./use-form-common-props-CZDNuDUm.js";import"./get-BNOfz7a2.js";import"./isArray-Dxzbedgu.js";import"./index-Cl32T4Tj.js";import"./aria-CHApNzmi.js";import"./index-CL1ggOOL.js";import"./index-CSTan3Pl.js";import"./index-LrBu9EIq.js";import"./index-Cz3lXVSV.js";import"./index-BLed4XWL.js";import"./index-CM0LdUiu.js";import"./isEqual-ZMkI4w92.js";import"./_Uint8Array-CSMkYC73.js";import"./vnode-B6PzXlGy.js";import"./refs-Dd4dlhR7.js";import"./event-BB_Ol6Sd.js";import"./typescript-Bp3YSIOJ.js";import"./_baseClone-Cky5vQQ9.js";import"./_initCloneObject-32_YsKBG.js";import"./castArray-Ce6QuK0j.js";const Re=le({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:Le}}),Se={click:a=>a instanceof MouseEvent},qe=Q({name:"ElLink"}),xe=Q({...qe,props:Re,emits:Se,setup(a,{emit:w}){const g=a,t=oe("link"),E=De(()=>[t.b(),t.m(g.type),t.is("disabled",g.disabled),t.is("underline",g.underline&&!g.disabled)]);function f(r){g.disabled||w("click",r)}return(r,m)=>(p(),_("a",{class:T(c(E)),href:r.disabled||!r.href?void 0:r.href,target:r.disabled||!r.href?void 0:r.target,onClick:f},[r.icon?(p(),y(c(ie),{key:0},{default:s(()=>[(p(),y(_e(r.icon)))]),_:1})):F("v-if",!0),r.$slots.default?(p(),_("span",{key:1,class:T(c(t).e("inner"))},[B(r.$slots,"default")],2)):F("v-if",!0),r.$slots.icon?B(r.$slots,"icon",{key:2}):F("v-if",!0)],10,["href","target"]))}});var Ie=se(xe,[["__file","link.vue"]]);const Pe=re(Ie),$e={class:"form-container"},Te=["src"],Be={style:{margin:"10px auto"}},Ne={__name:"ProductForm",props:{formData:Object,fileList:Array,uploadList:Array,mode:{type:String,default:"edit"}},emits:["update:file-list","update:form-data","submit","uploadList"],setup(a,{expose:w,emit:g}){const t=a,E=g;ye(t,"uploadList");const f=u(),r=u([]),m=u("top");u(!1);const x=u(""),C=u(!1),v=u(null),j=()=>new Promise((i,e)=>{v.value?v.value.validate(d=>{d?i(!0):e(!1)}):e(new Error("internalFormRef 未綁定"))}),A=()=>{},z=async i=>{const e=await he.post(`/back/categories/${i}/subsel`);t.formData.subcategories=e.data,t.formData.subcategory_id=e.data.length?e.data[0].id:""},G=Ee({name:[{required:!0,message:"產品名稱必填項",trigger:"blur"}],title:[{required:!0,message:"產品title為必選項",trigger:"submit"}],subcategory_id:[{required:!0,message:"子類別為必選項",trigger:"blur"}],published_status:[{required:!0,message:"請選擇顯示或隱藏",trigger:"submit"}],image:[{validator:(i,e,d)=>{var D;if(!f.value||f.value.length===0)return d();const n=(D=f.value[0])==null?void 0:D.raw;if(!n)return d();if(!["image/jpeg","image/png","image/gif"].includes(n.type))return d(new Error("圖片格式僅限 jpg/png/gif"));d()},trigger:"change"}],category_id:[{required:!0,message:"此選項為必填",trigger:"blur"}],special_start_at:[{type:"date",required:!1,message:"請選擇開始時間",trigger:"change"}],special_end_at:[{type:"date",required:!1,message:"請選擇結束時間",trigger:"change"},{validator:(i,e,d)=>{if(!e||!t.formData.special_start_at)return d();const n=new Date(t.formData.special_start_at);new Date(e)<n?d(new Error("結束時間需晚於開始時間")):d()},trigger:"change"}]}),U=u(null),L=u(null),b=t.mode=="edit"?u(!0):u(!1),K=(i,e)=>{f.value=[],E("uploadList",f.value)},M=i=>{x.value=i.url,C.value=!0},H=i=>{f.value=[{name:i.name,url:i.url,uid:i.uid,raw:i.raw}],E("uploadList",f.value)},J=i=>{r.value.clearFiles();const e=i[0];e.uid=pe(),r.value.handleStart(e)};return w({formValidate:j,internalFormRef:v,quillRef:U,specialQuillRef:L,resetForm:()=>{v.value.resetFields(),U.value.setText(""),L.value.setText("")},resetFormData:()=>{t.formData.id="",t.formData.name="",t.formData.title="",t.formData.price="",t.formData.subcategory_id="",t.formData.published_status="",t.formData.color_codes=[],t.formData.subcategories=[],t.formData.description="",t.formData.special_message="",t.formData.special_start_at="",t.formData.special_end_at=""},setFormData:i=>{t.formData.id=i.id,t.formData.name=i.name,t.formData.subcategories=i.subcategories,t.formData.title=i.title,t.formData.price=i.price,t.formData.subcategory_id=parseInt(i.subcategory_id),t.formData.published_status=parseInt(i.published_status),t.formData.color_codes=i.color_codes,t.formData.description=i.description,t.formData.special_message=i.special_message,t.formData.special_start_at=i.special_start_at,t.formData.special_end_at=i.special_end_at}}),(i,e)=>{const d=Ue,n=Ce,V=be,D=ve,I=ce,W=ge,X=me,Y=fe,Z=ue,P=Ve("QuillEditor"),ee=Pe,te=de,$=ne,ae=we;return p(),_("div",$e,[o(ae,{model:a.formData,"label-width":"300px",class:"demo-ruleForm",rules:G,ref_key:"internalFormRef",ref:v},{default:s(()=>[o(n,{label:"產品名稱","label-position":m.value,prop:"name"},{default:s(()=>[o(d,{modelValue:a.formData.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.formData.name=l)},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"產品title","label-position":m.value,prop:"title"},{default:s(()=>[o(d,{modelValue:a.formData.title,"onUpdate:modelValue":e[1]||(e[1]=l=>a.formData.title=l)},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"售價","label-position":m.value,prop:"title"},{default:s(()=>[o(d,{modelValue:a.formData.price,"onUpdate:modelValue":e[2]||(e[2]=l=>a.formData.price=l)},null,8,["modelValue"])]),_:1},8,["label-position"]),a.mode=="add"?(p(),y(n,{key:0,label:"類別","label-position":m.value,prop:"category_id"},{default:s(()=>[o(D,{modelValue:a.formData.category_id,"onUpdate:modelValue":e[3]||(e[3]=l=>a.formData.category_id=l),teleported:!1,onChange:e[4]||(e[4]=l=>z(a.formData.category_id))},{default:s(()=>[(p(!0),_(N,null,O(a.formData.categories,l=>(p(),y(V,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-position"])):F("",!0),o(n,{label:"子類別","label-position":m.value,prop:"subcategory_id"},{default:s(()=>[o(D,{modelValue:a.formData.subcategory_id,"onUpdate:modelValue":e[5]||(e[5]=l=>a.formData.subcategory_id=l),teleported:!1,onChange:A},{default:s(()=>[(p(!0),_(N,null,O(a.formData.subcategories,l=>(p(),y(V,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"操作","label-position":m.value,prop:"published_status"},{default:s(()=>[o(W,{modelValue:a.formData.published_status,"onUpdate:modelValue":e[6]||(e[6]=l=>a.formData.published_status=l)},{default:s(()=>[o(I,{value:1},{default:s(()=>e[13]||(e[13]=[k("上架")])),_:1}),o(I,{value:0},{default:s(()=>e[14]||(e[14]=[k("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"圖片","label-position":m.value,prop:"image"},{default:s(()=>[o(Y,{"file-list":a.fileList,class:"upload-demo",action:"","on-preview":M,"on-remove":K,"list-type":"picture","auto-upload":!1,limit:1,"on-exceed":J,ref_key:"upload",ref:r,"popper-class":"no-transition","on-change":H},{default:s(()=>[o(X,{type:"",style:{width:"40% !important"}},{default:s(()=>e[15]||(e[15]=[k("選擇檔案")])),_:1})]),_:1},8,["file-list"]),o(Z,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l)},{default:s(()=>[h("img",{"w-full":"",src:x.value,alt:"Preview Image",style:{margin:"auto"}},null,8,Te)]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"產品描述","label-position":m.value,prop:"description"},{default:s(()=>[o(P,{content:a.formData.description,"onUpdate:content":e[8]||(e[8]=l=>a.formData.description=l),"content-type":"html",theme:"snow",ref_key:"quillRef",ref:U,style:{"min-height":"200px"}},null,8,["content"])]),_:1},8,["label-position"]),e[17]||(e[17]=h("hr",{style:{margin:"10px auto"}},null,-1)),h("div",Be,[e[16]||(e[16]=h("span",null,"特惠欄位",-1)),o(te,{effect:"dark",content:c(b)?"點擊隱藏欄位":"點擊顯示欄位",placement:"top"},{default:s(()=>[o(ee,{onClick:e[9]||(e[9]=l=>b.value=!c(b)),type:"primary",underline:!1},{default:s(()=>[k(ke(c(b)?"[顯示]":"[隱藏]"),1)]),_:1})]),_:1},8,["content"])]),o(R,{name:"expand-fade"},{default:s(()=>[S(o(n,{label:"特惠訊息","label-position":m.value,prop:"special_message"},{default:s(()=>[o(P,{content:a.formData.special_message,"onUpdate:content":e[10]||(e[10]=l=>a.formData.special_message=l),"content-type":"html",theme:"snow",ref_key:"specialQuillRef",ref:L,style:{"min-height":"200px"}},null,8,["content"])]),_:1},8,["label-position"]),[[q,c(b)]])]),_:1}),o(R,{name:"expand-fade"},{default:s(()=>[S(o(n,{label:"特惠時間","label-position":m.value,prop:"special_start_at"},{default:s(()=>[o($,{modelValue:a.formData.special_start_at,"onUpdate:modelValue":e[11]||(e[11]=l=>a.formData.special_start_at=l),type:"datetime",placeholder:"開始時間",teleported:!1,style:{"margin-right":"10px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),[[q,c(b)]])]),_:1}),o(R,{name:"expand-fade"},{default:s(()=>[S(o(n,{label:"","label-position":m.value,prop:"special_end_at"},{default:s(()=>[o($,{modelValue:a.formData.special_end_at,"onUpdate:modelValue":e[12]||(e[12]=l=>a.formData.special_end_at=l),type:"datetime",placeholder:"結束時間",teleported:!1},null,8,["modelValue"])]),_:1},8,["label-position"]),[[q,c(b)]])]),_:1})]),_:1},8,["model","rules"])])}}},Lt=Fe(Ne,[["__scopeId","data-v-a50d9705"]]);export{Lt as default};
