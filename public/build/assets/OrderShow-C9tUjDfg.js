import{b as ie,d as be,u as ce,_ as we,E as ae,w as Ve,a as ze}from"./base-iHJmQtcg.js";import{v as Ae}from"./el-loading-Bs-3kzk-.js";import{E as De}from"./el-overlay-CtzYCaxC.js";import{E as Me}from"./el-button-CQNoZzvE.js";import{C as J,G as _e,aA as ye,r as f,g as Z,X as ge,H as Fe,o as h,i as E,n as se,u as L,I as Ce,E as he,f as W,y as Te,aE as Le,a as r,ad as qe,ae as Ue,K as He,D as Ie,A as fe,bL as Ye,aq as xe,a0 as Ke,B as je,V as We,b7 as ke,p as Ee,au as Ge,j as Se,L as Xe,k as Y,b as c,N as te,O as ne,m as Ze,t as $,d as X,c as re,w as q,q as Je,bM as Qe,bN as et,bO as tt,bP as at,z as le}from"./app-JKzr_vVp.js";import{_ as st}from"./FrontendLayout-BzAIY7qa.js";import ot from"./ReturnForm-DpkQsvM0.js";import nt from"./ReturnHistory-BUNnHMAo.js";import rt from"./CancelForm-CASZJNWZ.js";import{d as ve}from"./dayjs.min-Dd8mipII.js";import{E as lt}from"./el-message-box-Dib-1QJt.js";/* empty css                 *//* empty css                        */import{E as it}from"./index-DSWjJ9cE.js";import{k as pe,x as ct,y as dt}from"./use-form-common-props-CZDNuDUm.js";import{m as $e}from"./typescript-Bp3YSIOJ.js";import{c as j}from"./el-select-7TH_FEuU.js";import{E as K}from"./aria-CHApNzmi.js";import{U as Pe}from"./event-BB_Ol6Sd.js";import{u as ut}from"./index-CKck6qGF.js";import"./vnode-B6PzXlGy.js";import"./el-popper-CJSoZX_d.js";import"./index-CSTan3Pl.js";import"./get-BNOfz7a2.js";import"./isArray-Dxzbedgu.js";import"./index-Cl32T4Tj.js";import"./icon-MSFJ_NKx.js";import"./refs-Dd4dlhR7.js";import"./index-CL1ggOOL.js";import"./el-main-Bf9q-4AZ.js";import"./el-col-Db_ElxR5.js";import"./el-avatar-B4DVVCcp.js";import"./el-scrollbar-BLZesUDu.js";import"./castArray-Ce6QuK0j.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                     */import"./el-tag-CPuyrTQm.js";import"./_Uint8Array-CSMkYC73.js";import"./isEqual-ZMkI4w92.js";import"./el-input-number-Dor3SLTI.js";import"./index-CcXRvPvX.js";import"./index-BLed4XWL.js";import"./index-CM0LdUiu.js";import"./index-LrBu9EIq.js";import"./el-checkbox-DaMGGUhv.js";import"./index-DJdM4qGV.js";import"./_baseClone-Cky5vQQ9.js";import"./_initCloneObject-32_YsKBG.js";import"./index-Cz3lXVSV.js";import"./index-DBtc7dMN.js";const de=Symbol("tabsRootContextKey"),vt=ie({tabs:{type:be(Array),default:()=>$e([])}}),Be="ElTabBar",mt=J({name:Be}),ft=J({...mt,props:vt,setup(e,{expose:i}){const s=e,C=he(),t=_e(de);t||ye(Be,"<el-tabs><el-tab-bar /></el-tabs>");const x=ce("tabs"),R=f(),b=f(),k=()=>{let d=0,w=0;const p=["top","bottom"].includes(t.props.tabPosition)?"width":"height",D=p==="width"?"x":"y",l=D==="x"?"left":"top";return s.tabs.every(P=>{var V,z;const T=(z=(V=C.parent)==null?void 0:V.refs)==null?void 0:z[`tab-${P.uid}`];if(!T)return!1;if(!P.active)return!0;d=T[`offset${j(l)}`],w=T[`client${j(p)}`];const A=window.getComputedStyle(T);return p==="width"&&(w-=Number.parseFloat(A.paddingLeft)+Number.parseFloat(A.paddingRight),d+=Number.parseFloat(A.paddingLeft)),!1}),{[p]:`${w}px`,transform:`translate${j(D)}(${d}px)`}},S=()=>b.value=k(),_=[],v=()=>{var d;_.forEach(p=>p.stop()),_.length=0;const w=(d=C.parent)==null?void 0:d.refs;if(w){for(const p in w)if(p.startsWith("tab-")){const D=w[p];D&&_.push(pe(D,S))}}};Z(()=>s.tabs,async()=>{await ge(),S(),v()},{immediate:!0});const y=pe(R,()=>S());return Fe(()=>{_.forEach(d=>d.stop()),_.length=0,y.stop()}),i({ref:R,update:S}),(d,w)=>(h(),E("div",{ref_key:"barRef",ref:R,class:se([L(x).e("active-bar"),L(x).is(L(t).props.tabPosition)]),style:Ce(b.value)},null,6))}});var pt=we(ft,[["__file","tab-bar.vue"]]);const bt=ie({panes:{type:be(Array),default:()=>$e([])},currentName:{type:[String,Number],default:""},editable:Boolean,type:{type:String,values:["card","border-card",""],default:""},stretch:Boolean}),_t={tabClick:(e,i,s)=>s instanceof Event,tabRemove:(e,i)=>i instanceof Event},Ne="ElTabNav",yt=J({name:Ne,props:bt,emits:_t,setup(e,{expose:i,emit:s}){const C=_e(de);C||ye(Ne,"<el-tabs><tab-nav /></el-tabs>");const t=ce("tabs"),x=ct(),R=dt(),b=f(),k=f(),S=f(),_=f(),v=f(!1),y=f(0),d=f(!1),w=f(!0),p=W(()=>["top","bottom"].includes(C.props.tabPosition)?"width":"height"),D=W(()=>({transform:`translate${p.value==="width"?"X":"Y"}(-${y.value}px)`})),l=()=>{if(!b.value)return;const u=b.value[`offset${j(p.value)}`],m=y.value;if(!m)return;const o=m>u?m-u:0;y.value=o},P=()=>{if(!b.value||!k.value)return;const u=k.value[`offset${j(p.value)}`],m=b.value[`offset${j(p.value)}`],o=y.value;if(u-o<=m)return;const B=u-o>m*2?o+m:u-m;y.value=B},V=async()=>{const u=k.value;if(!v.value||!S.value||!b.value||!u)return;await ge();const m=S.value.querySelector(".is-active");if(!m)return;const o=b.value,B=["top","bottom"].includes(C.props.tabPosition),N=m.getBoundingClientRect(),O=o.getBoundingClientRect(),M=B?u.offsetWidth-O.width:u.offsetHeight-O.height,F=y.value;let n=F;B?(N.left<O.left&&(n=F-(O.left-N.left)),N.right>O.right&&(n=F+N.right-O.right)):(N.top<O.top&&(n=F-(O.top-N.top)),N.bottom>O.bottom&&(n=F+(N.bottom-O.bottom))),n=Math.max(n,0),y.value=Math.min(n,M)},z=()=>{var u;if(!k.value||!b.value)return;e.stretch&&((u=_.value)==null||u.update());const m=k.value[`offset${j(p.value)}`],o=b.value[`offset${j(p.value)}`],B=y.value;o<m?(v.value=v.value||{},v.value.prev=B,v.value.next=B+o<m,m-B<o&&(y.value=m-o)):(v.value=!1,B>0&&(y.value=0))},T=u=>{let m=0;switch(u.code){case K.left:case K.up:m=-1;break;case K.right:case K.down:m=1;break;default:return}const o=Array.from(u.currentTarget.querySelectorAll("[role=tab]:not(.is-disabled)"));let N=o.indexOf(u.target)+m;N<0?N=o.length-1:N>=o.length&&(N=0),o[N].focus({preventScroll:!0}),o[N].click(),A()},A=()=>{w.value&&(d.value=!0)},Q=()=>d.value=!1;return Z(x,u=>{u==="hidden"?w.value=!1:u==="visible"&&setTimeout(()=>w.value=!0,50)}),Z(R,u=>{u?setTimeout(()=>w.value=!0,50):w.value=!1}),pe(S,z),Te(()=>setTimeout(()=>V(),0)),Le(()=>z()),i({scrollToActiveTab:V,removeFocus:Q}),()=>{const u=v.value?[r("span",{class:[t.e("nav-prev"),t.is("disabled",!v.value.prev)],onClick:l},[r(ae,null,{default:()=>[r(qe,null,null)]})]),r("span",{class:[t.e("nav-next"),t.is("disabled",!v.value.next)],onClick:P},[r(ae,null,{default:()=>[r(Ue,null,null)]})])]:null,m=e.panes.map((o,B)=>{var N,O,M,F;const n=o.uid,a=o.props.disabled,I=(O=(N=o.props.name)!=null?N:o.index)!=null?O:`${B}`,G=!a&&(o.isClosable||e.editable);o.index=`${B}`;const oe=G?r(ae,{class:"is-icon-close",onClick:U=>s("tabRemove",o,U)},{default:()=>[r(He,null,null)]}):null,ue=((F=(M=o.slots).label)==null?void 0:F.call(M))||o.props.label,ee=!a&&o.active?0:-1;return r("div",{ref:`tab-${n}`,class:[t.e("item"),t.is(C.props.tabPosition),t.is("active",o.active),t.is("disabled",a),t.is("closable",G),t.is("focus",d.value)],id:`tab-${I}`,key:`tab-${n}`,"aria-controls":`pane-${I}`,role:"tab","aria-selected":o.active,tabindex:ee,onFocus:()=>A(),onBlur:()=>Q(),onClick:U=>{Q(),s("tabClick",o,I,U)},onKeydown:U=>{G&&(U.code===K.delete||U.code===K.backspace)&&s("tabRemove",o,U)}},[ue,oe])});return r("div",{ref:S,class:[t.e("nav-wrap"),t.is("scrollable",!!v.value),t.is(C.props.tabPosition)]},[u,r("div",{class:t.e("nav-scroll"),ref:b},[r("div",{class:[t.e("nav"),t.is(C.props.tabPosition),t.is("stretch",e.stretch&&["top","bottom"].includes(C.props.tabPosition))],ref:k,style:D.value,role:"tablist",onKeydown:T},[e.type?null:r(pt,{ref:_,tabs:[...e.panes]},null),m])])])}}}),gt=ie({type:{type:String,values:["card","border-card",""],default:""},closable:Boolean,addable:Boolean,modelValue:{type:[String,Number]},editable:Boolean,tabPosition:{type:String,values:["top","right","bottom","left"],default:"top"},beforeLeave:{type:be(Function),default:()=>!0},stretch:Boolean}),me=e=>Ke(e)||je(e),ht={[Pe]:e=>me(e),tabClick:(e,i)=>i instanceof Event,tabChange:e=>me(e),edit:(e,i)=>["remove","add"].includes(i),tabRemove:e=>me(e),tabAdd:()=>!0},xt=J({name:"ElTabs",props:gt,emits:ht,setup(e,{emit:i,slots:s,expose:C}){var t;const x=ce("tabs"),R=W(()=>["left","right"].includes(e.tabPosition)),{children:b,addChild:k,removeChild:S}=ut(he(),"ElTabPane"),_=f(),v=f((t=e.modelValue)!=null?t:"0"),y=async(l,P=!1)=>{var V,z,T;if(!(v.value===l||xe(l)))try{await((V=e.beforeLeave)==null?void 0:V.call(e,l,v.value))!==!1&&(v.value=l,P&&(i(Pe,l),i("tabChange",l)),(T=(z=_.value)==null?void 0:z.removeFocus)==null||T.call(z))}catch{}},d=(l,P,V)=>{l.props.disabled||(y(P,!0),i("tabClick",l,V))},w=(l,P)=>{l.props.disabled||xe(l.props.name)||(P.stopPropagation(),i("edit",l.props.name,"remove"),i("tabRemove",l.props.name))},p=()=>{i("edit",void 0,"add"),i("tabAdd")};Z(()=>e.modelValue,l=>y(l)),Z(v,async()=>{var l;await ge(),(l=_.value)==null||l.scrollToActiveTab()}),Ie(de,{props:e,currentName:v,registerPane:l=>{b.value.push(l)},sortPane:k,unregisterPane:S}),C({currentName:v});const D=({render:l})=>l();return()=>{const l=s["add-icon"],P=e.editable||e.addable?r("div",{class:[x.e("new-tab"),R.value&&x.e("new-tab-vertical")],tabindex:"0",onClick:p,onKeydown:T=>{[K.enter,K.numpadEnter].includes(T.code)&&p()}},[l?fe(s,"add-icon"):r(ae,{class:x.is("icon-plus")},{default:()=>[r(Ye,null,null)]})]):null,V=r("div",{class:[x.e("header"),R.value&&x.e("header-vertical"),x.is(e.tabPosition)]},[r(D,{render:()=>{const T=b.value.some(A=>A.slots.label);return r(yt,{ref:_,currentName:v.value,editable:e.editable,type:e.type,panes:b.value,stretch:e.stretch,onTabClick:d,onTabRemove:w},{$stable:!T})}},null),P]),z=r("div",{class:x.e("content")},[fe(s,"default")]);return r("div",{class:[x.b(),x.m(e.tabPosition),{[x.m("card")]:e.type==="card",[x.m("border-card")]:e.type==="border-card"}]},[z,V])}}});var kt=xt;const Nt=ie({label:{type:String,default:""},name:{type:[String,Number]},closable:Boolean,disabled:Boolean,lazy:Boolean}),Oe="ElTabPane",wt=J({name:Oe}),Ct=J({...wt,props:Nt,setup(e){const i=e,s=he(),C=We(),t=_e(de);t||ye(Oe,"usage: <el-tabs><el-tab-pane /></el-tabs/>");const x=ce("tab-pane"),R=f(),b=W(()=>i.closable||t.props.closable),k=ke(()=>{var d;return t.currentName.value===((d=i.name)!=null?d:R.value)}),S=f(k.value),_=W(()=>{var d;return(d=i.name)!=null?d:R.value}),v=ke(()=>!i.lazy||S.value||k.value);Z(k,d=>{d&&(S.value=!0)});const y=Ee({uid:s.uid,slots:C,props:i,paneName:_,active:k,index:R,isClosable:b});return t.registerPane(y),Te(()=>{t.sortPane(y)}),Ge(()=>{t.unregisterPane(y.uid)}),(d,w)=>L(v)?Se((h(),E("div",{key:0,id:`pane-${L(_)}`,class:se(L(x).b()),role:"tabpanel","aria-hidden":!L(k),"aria-labelledby":`tab-${L(_)}`},[fe(d.$slots,"default")],10,["id","aria-hidden","aria-labelledby"])),[[Xe,L(k)]]):Y("v-if",!0)}});var Re=we(Ct,[["__file","tab-pane.vue"]]);const Tt=Ve(kt,{TabPane:Re}),Et=ze(Re),St={class:"container mx-auto px-4 sm:py-8 max-w-[1680px] md:px-12 lg:px-16 xl:px-20 2xl:px-24"},$t={class:"list"},Pt={class:"line"},Bt={key:0,class:"list-con"},Ot={key:1,class:"list-con2"},Rt={key:2,class:"list-con2"},Vt={class:"order-item-lists"},zt={class:"item-imgs"},At=["src"],Dt={class:"item-details"},Mt={class:"item-name"},Ft={class:"item-qty"},Lt={class:"item-price"},qt={class:"order-info"},Ut={class:"grid-cell"},Ht={class:"grid-cell"},It={class:"grid-cell"},Yt={class:"grid-cell total-price"},Kt={class:"grid-cell"},jt={key:0},Wt={key:1},Gt={class:"grid-cell"},Xt={key:2},Zt={key:3},Jt={class:"text-base"},Qt={class:"mt-2"},ea={class:"text-lg text-purple-600"},ta={key:0,class:"grid mt-6"},aa=0,sa=2,es={__name:"OrderShow",props:{order:{type:Object},total_qty:{type:Number},return_reasons:{type:Array}},setup(e){const i=e,s=Ee({order:i.order,total_qty:i.total_qty,return_reasons:i.return_reasons}),C=[{title:"訂單成立",icon:Qe},{title:"付款資訊確認",icon:et},{title:"運送中",icon:tt},{title:"已送達",icon:at}],t=f(s.order.step_index),x=[{title:"申請取消"},{title:"已取消"}],R=[{title:"寄回商品"},{title:"商品驗收中"},{title:"已退款"}],b=W(()=>C.length<=1?"0%":`${t.value/(C.length-1)*(860/1e3*100)}%`),k=f("first"),S=(n,a)=>{switch(n.props.name){case"first":break;case"second":V();break}},_=f(!1),v=f(!1),y=()=>{_.value=!_.value},d=async()=>{(await le.patch(route("order.cancel",{order:s.order.order_number}),{})).data.msg=="訂單已取消"&&(s.order.fulfilment_status="cancelled")},w=()=>{lt.confirm("確定要取消訂單?","",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{d()}).catch(()=>{})},p=f(""),D=async n=>{const a=await le.get(`/order/fetchOrderData/${n}`);s.order=a.data.order,s.total_qty=a.data.total_qty,await l()},l=()=>p.value.resetForm();f(!1);const P=f(),V=async()=>{const n=i.order.id,a=await le.get(`/return/return-history/${n}`);try{const I=await le.get(`/return/return-history/${n}`);P.value=I.data}catch{O("error","資料讀取失敗")}finally{z.value=!1}},z=f(!0),T=f(!1),A=ve(s.order.created_at.replace("Z","")).add(4,"hour").format("YYYY-MM-DD HH:mm:ss"),Q=ve().isAfter(A),u=()=>{s.order.order_status=6,s.order.order_status_label="已取消"},m=W(()=>["shipped","pending","processing"].includes(s.order.fulfilment_status)),o=W(()=>["delivered"].includes(s.order.fulfilment_status)),B=(n,a)=>{t.value=n,b.value=a};function N(n){window.location.href=`/payment/retry/${n}`}const O=(n,a)=>{it({type:n,title:a,position:"bottom-left"})};function M(n){return!n&&n!==0?"NT$":`NT$${Number(n).toLocaleString("en-US")}`}function F(n){return ve(n).format("YYYY/MM/DD HH:mm")}return(n,a)=>{const I=ae,G=Me,oe=Et,ue=Tt,ee=De,U=Ae;return h(),E(te,null,[r(st),c("div",St,[c("div",$t,[c("div",Pt,[a[6]||(a[6]=c("div",{class:"line-background"},null,-1)),t.value>0?(h(),E("div",{key:0,class:"line-foreground",style:Ce({width:b.value})},null,4)):Y("",!0)]),t.value>=0?(h(),E("ul",Bt,[(h(),E(te,null,ne(C,(g,H)=>c("li",{key:H,class:se({active:H<=t.value})},[r(I,null,{default:q(()=>[(h(),re(Je(g.icon)))]),_:2},1024),c("div",null,$(g.title),1)],2)),64))])):t.value===-1?(h(),E("ul",Ot,[(h(),E(te,null,ne(x,(g,H)=>c("li",{key:H,class:se({active:H<=aa})},[c("div",null,$(g.title),1)],2)),64))])):t.value===-2?(h(),E("ul",Rt,[(h(),E(te,null,ne(R,(g,H)=>c("li",{key:H,class:se({active:H<=sa})},[c("div",null,$(g.title),1)],2)),64))])):Y("",!0)]),(h(!0),E(te,null,ne(s.order.order_items,(g,H)=>(h(),E("div",Vt,[c("div",zt,[c("img",{src:g.image,style:{"max-width":"100px"}},null,8,At)]),c("div",Dt,[c("div",Mt,$(g.name),1),c("div",Ft," x"+$(g.quantity),1)]),c("div",Lt,$(M(g.price)),1)]))),256)),c("div",qt,[a[9]||(a[9]=Ze('<div class="grid-header">配送方式</div><div class="grid-header">訂單日期</div><div class="grid-header">訂單編號</div><div class="grid-header">數量</div><div class="grid-header">訂購總額</div><div class="grid-header">付款方式</div><div class="grid-header">操作</div><div class="grid-cell">宅配</div>',8)),c("div",Ut,$(F(s.order.created_at)),1),c("div",Ht,$(s.order.order_number),1),c("div",It,$(e.total_qty),1),c("div",Yt,$(M(s.order.amount)),1),c("div",Kt,[X($(s.order.payment_method_label??"-")+" ",1),s.order.payment_status_label=="待付款"?(h(),E("span",jt,[c("span",{class:"text-blue-600 cursor-pointer hover:text-pink-600 hover:underline",onClick:a[0]||(a[0]=g=>T.value=!0)}," ("+$(s.order.payment_status_label)+") ",1)])):(h(),E("span",Wt," ("+$(s.order.payment_status_label)+") ",1))]),c("div",Gt,[m.value?(h(),re(G,{key:0,link:"",type:"primary",onClick:w},{default:q(()=>a[7]||(a[7]=[X("取消")])),_:1})):Y("",!0),o.value?(h(),re(G,{key:1,link:"",type:"primary",onClick:y},{default:q(()=>a[8]||(a[8]=[X("退貨")])),_:1})):Y("",!0),s.order.fulfilment_status==="cancelled"?(h(),E("span",Xt,"已取消")):Y("",!0),s.order.fulfilment_status==="returned"?(h(),E("span",Zt,"已退貨")):Y("",!0)])])]),r(ee,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=g=>_.value=g),title:"",class:"return-dialog","align-center":""},{default:q(()=>[r(ue,{modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=g=>k.value=g),class:"demo-tabs",onTabClick:S},{default:q(()=>[r(oe,{label:"退貨申請",name:"first"},{default:q(()=>[r(ot,{ref_key:"returnRef",ref:p,order:s.order,return_reasons:e.return_reasons,"to-currency":M,onGetOrderNum:D,onChangeStep:B},null,8,["order","return_reasons"])]),_:1}),Se((h(),re(oe,{label:"退貨紀錄",name:"second"},{default:q(()=>[r(nt,{ref:"historyRef","history-data":P.value,"formate-date":F,"to-currency":M},null,8,["history-data"])]),_:1})),[[U,z.value]])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),r(ee,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=g=>v.value=g),title:"",class:"cancel-dialog","align-center":""},{default:q(()=>[r(rt,{order:s.order,"to-currency":M,onOrderCanceled:u},null,8,["order"])]),_:1},8,["modelValue"]),r(ee,{modelValue:T.value,"onUpdate:modelValue":a[5]||(a[5]=g=>T.value=g),title:"訂購資訊 / 付款",width:"500","align-center":""},{default:q(()=>[c("span",null,[X($(s.order.payment_method_label+"支付繳費期限：")+" ",1),c("span",Jt,$(L(A)),1),a[12]||(a[12]=c("p",{class:"text-red-500 text-sm"}," (若超過繳費期費，仍未付款，訂單將自動取消) ",-1)),c("p",Qt,[a[10]||(a[10]=X(" 信用卡繳費金額: ")),c("span",ea,$(M(e.order.amount)),1)]),!L(Q)&&t.value>=0?(h(),E("div",ta,[r(G,{size:"large",onClick:a[4]||(a[4]=g=>N(s.order.order_number))},{default:q(()=>a[11]||(a[11]=[X("前往支付")])),_:1})])):Y("",!0)])]),_:1},8,["modelValue"])],64)}}};export{es as default};
