import{B as de,C as se,bx as ge,by as Se,bz as Ne,r as h,bA as xe,_ as Oe,f,g as fe,X as be,y as he,o as b,c as ve,w as y,a as c,a8 as Te,b as w,n as d,u as a,I as ye,e as Ae,k as L,K as Re,i as E,N as ne,ad as $e,ae as Me,bB as Be,aN as Pe,q as Ve,bC as Ye,bD as De,O as Fe,j as Xe,L as He,A as te,bE as ue,ak as je,Y as X,a9 as Ke,t as qe,a4 as we,aG as Ge,a0 as We,bF as Ze,bG as Je,bH as Qe}from"./app-rUP0WFHc.js";import{j as $,v as Ue}from"./use-form-common-props-BeLgxl5I.js";import{c as ea,d as aa}from"./el-popper-B0TJAX3S.js";import{b as ke,d as H,u as _e,E as x,_ as Ie,w as Ce,g as ta}from"./base-DdF9LHzb.js";import{m as Le}from"./typescript-Bp3YSIOJ.js";import{u as ze}from"./index-CTujAvOj.js";import{c as na,E as R}from"./aria-CAJK2HN2.js";import{u as sa}from"./index-Dw169JbW.js";const oa=ke({urlList:{type:H(Array),default:()=>Le([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),la={close:()=>!0,switch:v=>de(v),rotate:v=>de(v)},ra=se({name:"ElImageViewer"}),ia=se({...ra,props:oa,emits:la,setup(v,{expose:O,emit:u}){var M;const l=v,m={CONTAIN:{name:"contain",icon:ge(Se)},ORIGINAL:{name:"original",icon:ge(Ne)}},{t:oe}=ze(),s=_e("image-viewer"),{nextZIndex:le}=na(),T=h(),S=h([]),z=xe(),_=h(!0),p=h(l.initialIndex),g=Oe(m.CONTAIN),o=h({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),B=h((M=l.zIndex)!=null?M:le()),P=f(()=>{const{urlList:t}=l;return t.length<=1}),j=f(()=>p.value===0),K=f(()=>p.value===l.urlList.length-1),V=f(()=>l.urlList[p.value]),re=f(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!l.infinite&&j.value)]),q=f(()=>[s.e("btn"),s.e("next"),s.is("disabled",!l.infinite&&K.value)]),Y=f(()=>{const{scale:t,deg:i,offsetX:n,offsetY:k,enableTransition:I}=o.value;let C=n/t,N=k/t;const F=i*Math.PI/180,me=Math.cos(F),pe=Math.sin(F);C=C*me+N*pe,N=N*me-n/t*pe;const ce={transform:`scale(${t}) rotate(${i}deg) translate(${C}px, ${N}px)`,transition:I?"transform .3s":""};return g.value.name===m.CONTAIN.name&&(ce.maxWidth=ce.maxHeight="100%"),ce});function A(){G(),u("close")}function ie(){const t=ue(n=>{switch(n.code){case R.esc:l.closeOnPressEscape&&A();break;case R.space:U();break;case R.left:ee();break;case R.up:r("zoomIn");break;case R.right:e();break;case R.down:r("zoomOut");break}}),i=ue(n=>{const k=n.deltaY||n.deltaX;r(k<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});z.run(()=>{$(document,"keydown",t),$(document,"wheel",i)})}function G(){z.stop()}function W(){_.value=!1}function Z(t){_.value=!1,t.target.alt=oe("el.image.error")}function J(t){if(_.value||t.button!==0||!T.value)return;o.value.enableTransition=!1;const{offsetX:i,offsetY:n}=o.value,k=t.pageX,I=t.pageY,C=ue(F=>{o.value={...o.value,offsetX:i+F.pageX-k,offsetY:n+F.pageY-I}}),N=$(document,"mousemove",C);$(document,"mouseup",()=>{N()}),t.preventDefault()}function Q(){o.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function U(){if(_.value)return;const t=Ue(m),i=Object.values(m),n=g.value.name,I=(i.findIndex(C=>C.name===n)+1)%t.length;g.value=m[t[I]],Q()}function D(t){const i=l.urlList.length;p.value=(t+i)%i}function ee(){j.value&&!l.infinite||D(p.value-1)}function e(){K.value&&!l.infinite||D(p.value+1)}function r(t,i={}){if(_.value)return;const{minScale:n,maxScale:k}=l,{zoomRate:I,rotateDeg:C,enableTransition:N}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...i};switch(t){case"zoomOut":o.value.scale>n&&(o.value.scale=Number.parseFloat((o.value.scale/I).toFixed(3)));break;case"zoomIn":o.value.scale<k&&(o.value.scale=Number.parseFloat((o.value.scale*I).toFixed(3)));break;case"clockwise":o.value.deg+=C,u("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=C,u("rotate",o.value.deg);break}o.value.enableTransition=N}function ae(t){var i;((i=t.detail)==null?void 0:i.focusReason)==="pointer"&&t.preventDefault()}function Ee(){l.closeOnPressEscape&&A()}return fe(V,()=>{be(()=>{const t=S.value[0];t!=null&&t.complete||(_.value=!0)})}),fe(p,t=>{Q(),u("switch",t)}),he(()=>{ie()}),O({setActiveItem:D}),(t,i)=>(b(),ve(a(aa),{to:"body",disabled:!t.teleported},{default:y(()=>[c(Te,{name:"viewer-fade",appear:""},{default:y(()=>[w("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:d(a(s).e("wrapper")),style:ye({zIndex:B.value})},[c(a(ea),{loop:"",trapped:"","focus-trap-el":T.value,"focus-start-el":"container",onFocusoutPrevented:ae,onReleaseRequested:Ee},{default:y(()=>[w("div",{class:d(a(s).e("mask")),onClick:Ae(n=>t.hideOnClickModal&&A(),["self"])},null,10,["onClick"]),L(" CLOSE "),w("span",{class:d([a(s).e("btn"),a(s).e("close")]),onClick:A},[c(a(x),null,{default:y(()=>[c(a(Re))]),_:1})],2),L(" ARROW "),a(P)?L("v-if",!0):(b(),E(ne,{key:0},[w("span",{class:d(a(re)),onClick:ee},[c(a(x),null,{default:y(()=>[c(a($e))]),_:1})],2),w("span",{class:d(a(q)),onClick:e},[c(a(x),null,{default:y(()=>[c(a(Me))]),_:1})],2)],64)),L(" ACTIONS "),w("div",{class:d([a(s).e("btn"),a(s).e("actions")])},[w("div",{class:d(a(s).e("actions__inner"))},[c(a(x),{onClick:n=>r("zoomOut")},{default:y(()=>[c(a(Be))]),_:1},8,["onClick"]),c(a(x),{onClick:n=>r("zoomIn")},{default:y(()=>[c(a(Pe))]),_:1},8,["onClick"]),w("i",{class:d(a(s).e("actions__divider"))},null,2),c(a(x),{onClick:U},{default:y(()=>[(b(),ve(Ve(a(g).icon)))]),_:1}),w("i",{class:d(a(s).e("actions__divider"))},null,2),c(a(x),{onClick:n=>r("anticlockwise")},{default:y(()=>[c(a(Ye))]),_:1},8,["onClick"]),c(a(x),{onClick:n=>r("clockwise")},{default:y(()=>[c(a(De))]),_:1},8,["onClick"])],2)],2),L(" CANVAS "),w("div",{class:d(a(s).e("canvas"))},[(b(!0),E(ne,null,Fe(t.urlList,(n,k)=>Xe((b(),E("img",{ref_for:!0,ref:I=>S.value[k]=I,key:n,src:n,style:ye(a(Y)),class:d(a(s).e("img")),crossorigin:t.crossorigin,onLoad:W,onError:Z,onMousedown:J},null,46,["src","crossorigin"])),[[He,k===p.value]])),128))],2),te(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ca=Ie(ia,[["__file","image-viewer.vue"]]);const ua=Ce(ca),da=ke({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:H([String,Object])},previewSrcList:{type:H(Array),default:()=>Le([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),fa={load:v=>v instanceof Event,error:v=>v instanceof Event,switch:v=>de(v),close:()=>!0,show:()=>!0},va=se({name:"ElImage",inheritAttrs:!1}),ma=se({...va,props:da,emits:fa,setup(v,{emit:O}){const u=v;let M="";const{t:l}=ze(),m=_e("image"),oe=je(),s=f(()=>ta(Object.entries(oe).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),le=sa({excludeListeners:!0,excludeKeys:f(()=>Object.keys(s.value))}),T=h(),S=h(!1),z=h(!0),_=h(!1),p=h(),g=h(),o=X&&"loading"in HTMLImageElement.prototype;let B,P;const j=f(()=>[m.e("inner"),V.value&&m.e("preview"),z.value&&m.is("loading")]),K=f(()=>{const{fit:e}=u;return X&&e?{objectFit:e}:{}}),V=f(()=>{const{previewSrcList:e}=u;return Ke(e)&&e.length>0}),re=f(()=>{const{previewSrcList:e,initialIndex:r}=u;let ae=r;return r>e.length-1&&(ae=0),ae}),q=f(()=>u.loading==="eager"?!1:!o&&u.loading==="lazy"||u.lazy),Y=()=>{X&&(z.value=!0,S.value=!1,T.value=u.src)};function A(e){z.value=!1,S.value=!1,O("load",e)}function ie(e){z.value=!1,S.value=!0,O("error",e)}function G(){Je(p.value,g.value)&&(Y(),J())}const W=Qe(G,200,!0);async function Z(){var e;if(!X)return;await be();const{scrollContainer:r}=u;Ge(r)?g.value=r:We(r)&&r!==""?g.value=(e=document.querySelector(r))!=null?e:void 0:p.value&&(g.value=Ze(p.value)),g.value&&(B=$(g,"scroll",W),setTimeout(()=>G(),100))}function J(){!X||!g.value||!W||(B==null||B(),g.value=void 0)}function Q(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function U(){V.value&&(P=$("wheel",Q,{passive:!1}),M=document.body.style.overflow,document.body.style.overflow="hidden",_.value=!0,O("show"))}function D(){P==null||P(),document.body.style.overflow=M,_.value=!1,O("close")}function ee(e){O("switch",e)}return fe(()=>u.src,()=>{q.value?(z.value=!0,S.value=!1,J(),Z()):Y()}),he(()=>{q.value?Z():Y()}),(e,r)=>(b(),E("div",we({ref_key:"container",ref:p},a(s),{class:[a(m).b(),e.$attrs.class]}),[S.value?te(e.$slots,"error",{key:0},()=>[w("div",{class:d(a(m).e("error"))},qe(a(l)("el.image.error")),3)]):(b(),E(ne,{key:1},[T.value!==void 0?(b(),E("img",we({key:0},a(le),{src:T.value,loading:e.loading,style:a(K),class:a(j),crossorigin:e.crossorigin,onClick:U,onLoad:A,onError:ie}),null,16,["src","loading","crossorigin"])):L("v-if",!0),z.value?(b(),E("div",{key:1,class:d(a(m).e("wrapper"))},[te(e.$slots,"placeholder",{},()=>[w("div",{class:d(a(m).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),a(V)?(b(),E(ne,{key:2},[_.value?(b(),ve(a(ua),{key:0,"z-index":e.zIndex,"initial-index":a(re),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:D,onSwitch:ee},{default:y(()=>[e.$slots.viewer?(b(),E("div",{key:0},[te(e.$slots,"viewer")])):L("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],16))}});var pa=Ie(ma,[["__file","image.vue"]]);const Ca=Ce(pa);export{Ca as E};
