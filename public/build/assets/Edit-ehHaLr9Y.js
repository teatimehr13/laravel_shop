import{E as K}from"./base-y2bNDJ1N.js";/* empty css                     */import{E as W}from"./el-date-picker-BvAB41Ca.js";/* empty css                 */import"./el-scrollbar-BFpWghct.js";import"./el-popper-DDu6zN0w.js";import{E as X}from"./el-button-S5Ft8LWf.js";import{E as Z}from"./el-overlay-CKholVpq.js";import{g as k,E as ee}from"./el-progress-Bjr0RPwo.js";import{E as te,a as oe}from"./el-radio-CFqxaimF.js";import"./el-tag-DSbumnHe.js";import{E as le,a as ae}from"./el-select-DV6P-RNB.js";import{p as q,r as _,h as R,i as $,a as o,b as g,w as s,N as B,F as ie,o as E,d as f,O as se,c as re}from"./app-DexmQPYs.js";import{H as ne}from"./Header-33lKnjaf.js";import{p as C}from"./purify.es-pRVhHGEY.js";/* empty css                        */import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as ue}from"./index-B7nIqj2e.js";import{E as de,a as me}from"./index-DSyyDpmu.js";import{E as ce}from"./index-DwFnUpSp.js";import"./dayjs.min-RxU7iPO6.js";import"./use-form-common-props-CX9-Vw_Z.js";import"./get-LIVOVZQE.js";import"./isArray-Dxzbedgu.js";import"./index-B-YGbumZ.js";import"./aria-CYg80bpG.js";import"./index-E4srtBzl.js";import"./index-BEPynLm9.js";import"./index-Cb-d8VtC.js";import"./index-CZTvpC4a.js";import"./index-B1sOmzmj.js";import"./index-D2eQEQ_s.js";import"./isEqual-DPXCwhuy.js";import"./_Uint8Array-4N7Pn6UK.js";import"./icon-Ci95ps6J.js";import"./vnode-BXgEiRvq.js";import"./refs-BUt9kmBx.js";import"./event-BB_Ol6Sd.js";import"./typescript-Bp3YSIOJ.js";import"./_baseClone-DzptsFvb.js";import"./_initCloneObject-D_mM-df0.js";import"./castArray-Ce6QuK0j.js";import"./el-col-BDlBwBQv.js";import"./el-avatar-C1cJygKQ.js";const ge={class:""},_e={class:"max-w-[1440px] mx-auto px-4 bg-white"},fe={class:"py-8"},be={class:"max-w-[1440px] mx-auto px-4 bg-white"},ve={class:"mx-2.5"},ye=["src"],we={__name:"Edit",props:{product:Object,subcategories:Array},setup(I){const x=I,t=q({...x.product}),u=_("top"),d=_([]);d.value=t.image?[{name:t.name,url:t.image,uid:k()}]:[];const V=_(""),b=_(!1),v=_([]),N=l=>{V.value=l.url,b.value=!0},O=l=>{d.value=[{name:l.name,url:l.url,uid:l.uid,raw:l.raw}]},P=(l,e)=>{d.value=[]},j=l=>{v.value.clearFiles();const e=l[0];e.uid=k(),v.value.handleStart(e)},L=q({name:[{required:!0,message:"產品名稱必填項",trigger:"blur"}],title:[{required:!0,message:"產品title為必填項",trigger:"submit"}],price:[{required:!0,message:"售價必填項",trigger:"submit"}],subcategory_id:[{required:!0,message:"子類別為必填項",trigger:"blur"}],published_status:[{required:!0,message:"請選擇顯示或隱藏",trigger:"submit"}],image:[{validator:(l,e,i)=>{var m;if(!d.value||d.value.length===0)return i();const p=(m=d.value[0])==null?void 0:m.raw;if(!p)return i();if(!["image/jpeg","image/png","image/gif"].includes(p.type))return i(new Error("圖片格式僅限 jpg/png/gif"));i()},trigger:"change"}],category_id:[{required:!0,message:"此選項為必填",trigger:"blur"}],special_start_at:[{type:"date",required:!1,message:"請選擇開始時間",trigger:"change"}],special_end_at:[{type:"date",required:!1,message:"請選擇結束時間",trigger:"change"},{validator:(l,e,i)=>{if(!e||!t.special_start_at)return i();const p=new Date(t.special_start_at);new Date(e)<p?i(new Error("結束時間需晚於開始時間")):i()},trigger:"change"}]}),y=_(null),M=async()=>{if(!y.value)throw new Error("internalFormRef 未綁定");return await y.value.validate()};let r=new FormData;const T=()=>{r=new FormData;const l=C.sanitize(t.description),e=C.sanitize(t.special_message);r.append("name",t.name),r.append("title",t.title),r.append("price",t.price),r.append("subcategory_id",t.subcategory_id),r.append("published_status",t.published_status),r.append("description",l),r.append("special_message",e),r.append("special_start_at",h(t.special_start_at)||""),r.append("special_end_at",h(t.special_end_at)||"");for(const[i,p]of r.entries());if(d.value.length>0){const i=d.value[0];i.raw&&r.append("image",i.raw)}else r.append("delete_image",!0);return r},A=async()=>{var l;try{await M(),await T(),r.append("_method","PATCH");const i=(await axios.post(`/back/products/${t.id}`,r,{headers:{"Content-Type":"multipart/form-data"},validateStatus:p=>p<400})).data;if(i){Object.assign(t,i),D("success","保存成功");return}}catch(e){if(e.response&&e.response.status===403){const i=((l=e.response.data)==null?void 0:l.message)||"保存失敗";D("warning",i);return}}};function h(l){if(!l)return null;let e;if(l instanceof Date)e=l;else if(typeof l=="string"){if(e=new Date(l),isNaN(e))return null}else return null;const i=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),m=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),w=String(e.getSeconds()).padStart(2,"0");return`${i}-${p}-${c} ${m}:${n}:${w}`}const D=(l,e)=>{ue({type:l,title:e,position:"bottom-left"})};function H(){ie.visit("/back/products")}return(l,e)=>{const i=R("ArrowLeft"),p=K,c=X,m=ce,n=me,w=le,Q=ae,F=te,z=oe,G=ee,Y=Z,S=R("QuillEditor"),U=W,J=de;return E(),$(B,null,[o(ne),g("main",ge,[g("div",_e,[g("p",fe,[o(c,{link:"",onClick:H,class:"hover:underline px-2 py-1"},{default:s(()=>[o(p,null,{default:s(()=>[o(i)]),_:1}),e[10]||(e[10]=f(" 回上一頁 "))]),_:1})])]),g("div",be,[g("div",ve,[o(J,{model:t,"label-width":"300px",class:"demo-ruleForm",rules:L,ref_key:"internalFormRef",ref:y},{default:s(()=>[o(n,{label:"產品名稱","label-position":u.value,prop:"name"},{default:s(()=>[o(m,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"產品title","label-position":u.value,prop:"title"},{default:s(()=>[o(m,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"價格","label-position":u.value,prop:"title"},{default:s(()=>[o(m,{modelValue:t.price,"onUpdate:modelValue":e[2]||(e[2]=a=>t.price=a),style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"子類別","label-position":u.value,prop:"subcategory_id"},{default:s(()=>[o(Q,{modelValue:t.subcategory_id,"onUpdate:modelValue":e[3]||(e[3]=a=>t.subcategory_id=a),modelModifiers:{number:!0},teleported:!1,style:{"max-width":"300px"}},{default:s(()=>[(E(!0),$(B,null,se(x.subcategories,a=>(E(),re(w,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"操作","label-position":u.value,prop:"published_status"},{default:s(()=>[o(z,{modelValue:t.published_status,"onUpdate:modelValue":e[4]||(e[4]=a=>t.published_status=a)},{default:s(()=>[o(F,{value:1},{default:s(()=>e[11]||(e[11]=[f("上架")])),_:1}),o(F,{value:0},{default:s(()=>e[12]||(e[12]=[f("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"圖片","label-position":u.value,prop:"image"},{default:s(()=>[o(G,{"file-list":d.value,class:"upload-demo",action:"","on-preview":N,"on-remove":P,"list-type":"picture","auto-upload":!1,limit:1,"on-exceed":j,ref_key:"upload",ref:v,"popper-class":"no-transition","on-change":O},{default:s(()=>[o(c,{type:""},{default:s(()=>e[13]||(e[13]=[f("選擇檔案")])),_:1})]),_:1},8,["file-list"]),o(Y,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a)},{default:s(()=>[g("img",{"w-full":"",src:V.value,alt:"Preview Image",style:{margin:"auto"}},null,8,ye)]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"產品描述","label-position":u.value,prop:"description",class:"quill-item"},{default:s(()=>[o(S,{content:t.description,"onUpdate:content":e[6]||(e[6]=a=>t.description=a),"content-type":"html",theme:"snow",ref:"quillRef",style:{"min-height":"200px"}},null,8,["content"])]),_:1},8,["label-position"]),e[14]||(e[14]=g("hr",{style:{margin:"10px auto"}},null,-1)),o(n,{label:"特惠訊息","label-position":u.value,prop:"special_message",class:"quill-item"},{default:s(()=>[o(S,{content:t.special_message,"onUpdate:content":e[7]||(e[7]=a=>t.special_message=a),"content-type":"html",theme:"snow",ref:"specialQuillRef",style:{"min-height":"200px"}},null,8,["content"])]),_:1},8,["label-position"]),o(n,{label:"特惠時間","label-position":u.value,prop:"special_start_at"},{default:s(()=>[o(U,{modelValue:t.special_start_at,"onUpdate:modelValue":e[8]||(e[8]=a=>t.special_start_at=a),type:"datetime",placeholder:"開始時間",teleported:!1,style:{"margin-right":"10px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"","label-position":u.value,prop:"special_end_at"},{default:s(()=>[o(U,{modelValue:t.special_end_at,"onUpdate:modelValue":e[9]||(e[9]=a=>t.special_end_at=a),type:"datetime",placeholder:"結束時間",teleported:!1},null,8,["modelValue"])]),_:1},8,["label-position"])]),_:1},8,["model","rules"])]),o(c,{class:"mx-2.5 mb-4",type:"primary",onClick:A},{default:s(()=>e[15]||(e[15]=[f(" 提交 ")])),_:1})])])],64)}}},mt=pe(we,[["__scopeId","data-v-baa76cb2"]]);export{mt as default};
