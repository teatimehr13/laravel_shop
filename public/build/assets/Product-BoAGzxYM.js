import"./base-DdF9LHzb.js";import{E as ze}from"./el-overlay-BtrBO0B-.js";import{E as Oe}from"./el-pagination-0ID2FAaJ.js";import"./el-tag-Ch_t78t2.js";import{E as je,a as Ie}from"./el-select-vY8immTa.js";import"./el-scrollbar-D-M4snyz.js";import{E as Me}from"./el-popper-B0TJAX3S.js";/* empty css                 */import{E as qe,a as He}from"./el-table-column-BUbEU7oj.js";import{E as Ke}from"./el-checkbox-XIduAFHh.js";import"./el-tooltip-l0sNRNKZ.js";import{E as Qe}from"./el-popover-CzPz6YOE.js";import{E as We}from"./el-button-DNj5ad6N.js";import{Q as Xe,p as O,r as s,g as ae,c as le,w as r,o as k,b as g,a,d as _,u as x,P as Ye,i as $,O as re,N as se,k as ne,t as ie,m as de,W as Ge,X as Je,z as E,F as pe}from"./app-rUP0WFHc.js";import{_ as Ze}from"./BackendLayout-CVPXA1cN.js";import eo from"./ProductForm-DOTTYjAk.js";import oo from"./ProductCoEditForm-C7YNpHLK.js";import to from"./ProductCoAddForm-Ne1ZQqCy.js";/* empty css                        */import"./el-progress-OMZRB744.js";/* empty css                        *//* empty css                                                                            */import{_ as ao}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D1AOqHMa.js";import{p as ue}from"./purify.es-pRVhHGEY.js";import{E as lo}from"./el-message-box-BSlGJn7O.js";import{E as ro}from"./index-C2tRIJKK.js";import{E as so}from"./index-BMrvmh7r.js";import"./vnode-C-uRYfLb.js";import"./icon-HjsV8w-5.js";import"./refs-C5awHzNN.js";import"./index-CTujAvOj.js";import"./get-Bq4Kqk5y.js";import"./isArray-Dxzbedgu.js";import"./event-BB_Ol6Sd.js";import"./aria-CAJK2HN2.js";import"./use-form-common-props-BeLgxl5I.js";import"./index-CR5GapiV.js";import"./typescript-Bp3YSIOJ.js";import"./isEqual-nt7ctgGs.js";import"./_Uint8Array-CHYqkzCa.js";import"./index-C9IVSUvu.js";import"./castArray-Ce6QuK0j.js";import"./index-B2iIRy8e.js";import"./index-CzXl0CR-.js";import"./_initCloneObject-DgXXankK.js";import"./el-main-dkI-bN8J.js";import"./Header-BmWDgAAb.js";import"./el-col-CWY6KSpn.js";import"./el-avatar-D50oI0pS.js";import"./index-BrGes_xZ.js";/* empty css                     */import"./el-date-picker-xovCs6qN.js";import"./dayjs.min-BVpsIZcM.js";import"./index-C0yLCE33.js";import"./index-Dw169JbW.js";import"./el-radio-D-SFzlxi.js";import"./index-CrKXfINh.js";import"./_baseClone-DZbmGIMq.js";import"./el-color-picker-ya9FAh8A.js";const no={class:"main-container"},io={class:"filters"},po={style:{display:"flex","align-items":"center",gap:"8px"}},uo=["src"],co={key:0},mo={style:{display:"flex","align-items":"center",gap:"8px"}},fo={class:"example-pagination-block"},go={__name:"Product",props:{products:{type:Object,required:!0},categories:{type:Object,required:!0},filters:Object,subcategories:Array},setup(Q){const W=Q,ce=Xe(),V=O({...W.products}),A=s(V.data),me=s([...W.categories]),f=ce.props.filters;f.subcategory_id=f.subcategory_id!=null?Number(f.subcategory_id):f.subcategory_id;const fe=o=>{w.value=o},n=O({name:"",title:"",subcategory_id:"",category_id:"",published_status:"",color_codes:[],subcategories:[],categories:me.value,description:"",special_message:"",special_start_at:null,special_end_at:null});O({data:[],current_page:1,last_page:null});const j=s(!1),I=s(!1),ge=({row:o})=>h.value===o.id?"activeRowFocus":"",_e=O({}),h=s(null),v=s([]),X=s(""),R=s(!1),Y=()=>{R.value=!R.value,we()},M=s([]);let w=s([]);const u=(o,e)=>{so({type:o,title:e,position:"bottom-left"})},N=s(null),ve=s(null),be=o=>{switch(o){case"edit":return ve.value.formValidate();case"add":return N.value.formValidate()}},we=()=>{Je(()=>{N.value.resetForm(),N.value.resetFormData(),M.value=[],w.value=[]})};let i=new FormData;const ye=()=>{i=new FormData;const o=ue.sanitize(n.description),e=ue.sanitize(n.special_message);i.append("name",n.name),i.append("title",n.title),i.append("price",n.price),i.append("subcategory_id",n.subcategory_id),i.append("published_status",n.published_status),i.append("color_codes",n.color_codes),i.append("description",o),i.append("special_message",e),i.append("special_start_at",n.special_start_at?oe(n.special_start_at):n.special_start_at),i.append("special_end_at",n.special_end_at?oe(n.special_end_at):n.special_end_at);for(const[l,d]of i.entries());if(w.value.length>0){const l=w.value[0];l.raw&&i.append("image",l.raw)}else i.append("delete_image",!0);return i},q=s({}),Ce=async()=>{try{await be("add"),await ye();const e=(await E.post("/back/products",i,{headers:{"Content-Type":"multipart/form-data"}})).data;if(e){R.value=!R.value,A.value.push(e),u("success","新增成功");return}u("error","新增失敗")}catch{u("error","保存失敗")}},Fe=async o=>{try{let e={id:o};const d=(await E.delete(`/back/products/${o}`,e,{headers:{"Content-Type":"multipart/form-data"}})).data;if(d.message="success"){A.value=A.value.filter(U=>U.id!==o),u("success","移除成功");return}u("error","移除失敗")}catch{}},G=s(null),H=s(!1),ke=async o=>{G.value=o.id,X.value=o.name+" 顏色管理";try{const e=await E.get(`/back/products/${o.id}/prod_options`);v.value=e.data,H.value=!0}catch{}};let c=new FormData;const xe=async o=>{if(C.value===o.id?C.value:null){if(!Object.keys(p.value).some(d=>p.value[d]!==o[d])&&!D.value.length){C.value=null;return}await J.value.colorFormValidate(),await Ee(),await Re(p.value.id)}else C.value=o.id,p.value={...o}},J=s(),p=s({}),C=s(null),Ee=()=>{if(c=new FormData,c.append("id",p.value.id),c.append("product_id",p.value.product_id),c.append("color_name",p.value.color_name),c.append("color_code",p.value.color_code),c.append("price",p.value.price),c.append("enable",p.value.enable),c.append("_method","PATCH"),D.value.length>0){const o=D.value[0].file;o&&c.append("image",o)}else p.value.image||c.append("delete_image",!0);return c},Ve=()=>{C.value=null,D.value=[]},D=s([]),Re=async o=>{try{const e=await E.post(`/back/product_options/${o}`,c,{headers:{"Content-Type":"multipart/form-data"}});if(e.data){const l=v.value.findIndex(d=>d.id===e.data.id);l!==-1&&(v.value[l]={...e.data,enable:Number(e.data.enable),price:Number(e.data.price)},C.value=null),u("success","保存成功")}}catch{u("error","保存失敗")}},T=s(),b=s({color_name:"",color_code:"",price:"",enable:"",image:"",product_id:G,published_status:1}),L=s(!1),S=s([]);let m=new FormData;const De=()=>{T.value.resetFields()},Le=()=>{L.value=!L.value,T.value.resetFields(),S.value=[]},Se=async()=>{await T.value.colorAddFormValidate(),await Ue(),await he()},Ue=()=>{if(m=new FormData,m.append("product_id",b.value.product_id),m.append("color_name",b.value.color_name),m.append("color_code",b.value.color_code),m.append("price",b.value.price),m.append("enable",b.value.enable),m.append("published_status",b.value.published_status),S.value.length>0){const o=S.value[0].file;o&&m.append("image",o)}else b.value.image||m.append("delete_image",!0);return m},he=async()=>{try{const o=await E.post("/back/product_options",m,{headers:{"Content-Type":"multipart/form-data"}});o.data&&(v.value.push({...o.data,enable:Number(o.data.enable),price:Number(o.data.price),published_status:1}),L.value=!L.value,T.value.resetFields(),S.value=[],u("success","新增成功"))}catch(o){if(o.response.data.comboExist){u("error",o.response.data.message);return}u("error","新增失敗")}},Z=async o=>{try{if((await E.delete(`/back/product_options/${o}`)).data.message=="success"){v.value=v.value.filter(l=>l.id!=o),u("success","刪除成功");return}}catch{u("error","刪除失敗")}},Te=async o=>{try{const l=(await E.get(`/back/product_options/${o}/checkImgs`)).data.image_count;if(l>0){let d=`該產品顏色尚有 ${l} 張產品附圖，是否確認刪除?`;$e(d,o)}else Z(o)}catch{}},$e=(o,e)=>{lo.confirm(o,{confirmButtonText:"是",cancelButtonText:"沒有"}).then(()=>{Z(e)})};ae(_e,o=>{for(const e in o)if(o[e]){h.value=Number(e);return}h.value=""},{deep:!0}),ae(q,o=>{for(const e in o)if(o[e]){h.value=Number(e);return}h.value=""},{deep:!0});const ee=()=>{const o=Object.fromEntries(Object.entries(f).filter(([e,l])=>l!==""&&l!==null));pe.get(route("products.index"),o)};function Ae(o){o=V.current_page;const e=Object.fromEntries(Object.entries(f).filter(([l,d])=>d!==""&&d!==null));pe.get("/back/products",{...e,page:o})}function oe(o){if(!o)return null;let e;if(o instanceof Date)e=o;else if(typeof o=="string"){if(e=new Date(o),isNaN(e))return null}else return null;const l=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),U=String(e.getDate()).padStart(2,"0"),K=String(e.getHours()).padStart(2,"0"),B=String(e.getMinutes()).padStart(2,"0"),P=String(e.getSeconds()).padStart(2,"0");return`${l}-${d}-${U} ${K}:${B}:${P}`}return(o,e)=>{const l=We,d=ro,U=je,K=Ie,B=Ke,P=Me,F=qe,Ne=Qe,Be=He,Pe=Oe,te=ze;return k(),le(Ze,null,{switch:r(()=>[g("div",no,[g("div",null,[a(l,{type:"",onClick:Y,style:{margin:"10px 0"}},{default:r(()=>e[18]||(e[18]=[_("新增產品")])),_:1})]),g("div",io,[a(d,{modelValue:x(f).name,"onUpdate:modelValue":e[0]||(e[0]=t=>x(f).name=t),placeholder:"輸入產品名稱",style:{width:"240px"},onKeyup:e[1]||(e[1]=Ye(t=>ee(),["enter"]))},null,8,["modelValue"]),a(K,{modelValue:x(f).subcategory_id,"onUpdate:modelValue":e[2]||(e[2]=t=>x(f).subcategory_id=t),placeholder:"選擇類別",onChange:e[3]||(e[3]=t=>ee()),style:{width:"150px"}},{default:r(()=>[a(U,{label:"全部類別",value:""}),(k(!0),$(se,null,re(Q.subcategories,(t,y)=>(k(),le(U,{key:t.id,value:Number(t.id),label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),a(Be,{data:A.value,style:{width:"100%"},"row-class-name":ge,border:""},{default:r(()=>[a(F,{width:"220",fixed:I.value?"left":!1,prop:"name"},{header:r(()=>[g("div",po,[e[19]||(e[19]=g("span",null,"產品名稱",-1)),a(P,{content:"固定/取消固定門市列"},{default:r(()=>[a(B,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t)},null,8,["modelValue"])]),_:1})])]),_:1},8,["fixed"]),a(F,{prop:"title",label:"產品title"}),a(F,{label:"圖片"},{default:r(t=>[t.row.image?(k(),$("img",{key:0,src:t.row.image,alt:"店面圖片",style:{"max-width":"75px","border-radius":"4px"}},null,8,uo)):ne("",!0)]),_:1}),a(F,{prop:"subcategory.name",label:"類別"}),a(F,{prop:"published_status",label:"狀態",width:"120"},{default:r(t=>[g("span",null,ie(t.row.published_status==1?"上架":"下架"),1)]),_:1}),a(F,{prop:"color_codes",label:"顏色"},{default:r(t=>[(k(!0),$(se,null,re(t.row.color_codes,(y,z)=>(k(),$("span",{key:z},[_(ie(y),1),z<t.row.color_codes.length-1?(k(),$("span",co,"、 ")):ne("",!0)]))),128))]),_:1}),a(F,{width:"300",fixed:j.value?"right":!1},{header:r(()=>[g("div",mo,[e[20]||(e[20]=g("span",null,"操作",-1)),a(P,{content:"固定/取消固定操作列"},{default:r(()=>[a(B,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=t=>j.value=t)},null,8,["modelValue"])]),_:1})])]),default:r(t=>[a(l,{onClick:y=>ke(t.row),size:"small",type:"info"},{default:r(()=>e[21]||(e[21]=[_(" 顏色管理 ")])),_:2},1032,["onClick"]),a(x(de),{href:o.route("images.show",t.row.id),style:{margin:"0 11px"}},{default:r(()=>[a(l,{size:"small",color:"#626aef",plain:""},{default:r(()=>e[22]||(e[22]=[_(" 附圖管理 ")])),_:1})]),_:2},1032,["href"]),a(x(de),{href:o.route("products.edit",t.row.id),style:{"margin-right":"11px"}},{default:r(()=>[a(l,{size:"small"},{default:r(()=>e[23]||(e[23]=[_(" 編輯 ")])),_:1})]),_:2},1032,["href"]),a(Ne,{title:"確定移除此筆資料?",onConfirm:y=>Fe(t.row.id),width:170,"hide-after":100,visible:q.value[t.row.id],"onUpdate:visible":y=>q.value[t.row.id]=y,placement:"left-end"},{reference:r(()=>[a(l,{size:"small",type:"danger"},{default:r(()=>e[24]||(e[24]=[_("移除")])),_:1})]),actions:r(({confirm:y,cancel:z})=>[a(l,{size:"small",onClick:z},{default:r(()=>e[25]||(e[25]=[_("沒有")])),_:2},1032,["onClick"]),a(l,{type:"danger",size:"small",onClick:y},{default:r(()=>e[26]||(e[26]=[_(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])]),_:1},8,["fixed"])]),_:1},8,["data"]),g("div",fo,[e[27]||(e[27]=g("div",{class:"example-demonstration"},null,-1)),a(Pe,{layout:"prev, pager, next",total:V.total,"page-size":V.per_page,"current-page":V.current_page,"onUpdate:currentPage":e[6]||(e[6]=t=>V.current_page=t),onCurrentChange:Ae,background:""},null,8,["total","page-size","current-page"])])]),a(te,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=t=>R.value=t),title:"新增",class:"productForm-dialog","align-center":""},{footer:r(()=>[a(l,{type:"primary",onClick:Ce},{default:r(()=>e[28]||(e[28]=[_("提交")])),_:1}),a(l,{onClick:Y},{default:r(()=>e[29]||(e[29]=[_("取消")])),_:1})]),default:r(()=>[a(eo,{"form-data":n,"onUpdate:formData":e[7]||(e[7]=t=>n=t),"file-list":M.value,"onUpdate:fileList":e[8]||(e[8]=t=>M.value=t),"upload-list":x(w),"onUpdate:uploadList":e[9]||(e[9]=t=>Ge(w)?w.value=t:w=t),onUploadList:fe,ref_key:"formRef",ref:N,mode:"add"},null,8,["form-data","file-list","upload-list"])]),_:1},8,["modelValue"]),a(te,{modelValue:H.value,"onUpdate:modelValue":e[17]||(e[17]=t=>H.value=t),title:X.value,width:"1000","align-center":""},{default:r(()=>[a(oo,{color_options_data:v.value,"onUpdate:color_options_data":e[11]||(e[11]=t=>v.value=t),fileList_co:D.value,"onUpdate:fileList_co":e[12]||(e[12]=t=>D.value=t),tempRow:p.value,"onUpdate:tempRow":e[13]||(e[13]=t=>p.value=t),editingRow:C.value,onToggleEdit:xe,onCancelEdit:Ve,onDelCo:Te,ref_key:"colorFormRef",ref:J},null,8,["color_options_data","fileList_co","tempRow","editingRow"]),a(to,{ref_key:"newCoFormRef",ref:T,newCoRowData:b.value,"onUpdate:newCoRowData":e[14]||(e[14]=t=>b.value=t),newCoRowVisible:L.value,"onUpdate:newCoRowVisible":e[15]||(e[15]=t=>L.value=t),fileListAdd_co:S.value,"onUpdate:fileListAdd_co":e[16]||(e[16]=t=>S.value=t),color_options_data:v.value,onToggleAdd:Se,onToggleAddBtn:Le,onRemoveVerify:De},null,8,["newCoRowData","newCoRowVisible","fileListAdd_co","color_options_data"])]),_:1},8,["modelValue","title"])]),_:1})}}},Ft=ao(go,[["__scopeId","data-v-c7815870"]]);export{Ft as default};
