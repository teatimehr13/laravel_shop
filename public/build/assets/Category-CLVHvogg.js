import"./base-DdF9LHzb.js";import{E as Oe}from"./el-overlay-BtrBO0B-.js";import{E as Ue,a as Re}from"./el-col-CWY6KSpn.js";import{E as Ae}from"./el-pagination-0ID2FAaJ.js";import"./el-tag-Ch_t78t2.js";import"./el-select-vY8immTa.js";import"./el-scrollbar-D-M4snyz.js";import{E as Ge}from"./el-popper-B0TJAX3S.js";/* empty css                 *//* empty css                     */import{E as Ye,a as Se}from"./el-table-column-BUbEU7oj.js";import"./el-checkbox-XIduAFHh.js";import"./el-tooltip-l0sNRNKZ.js";import{E as ze}from"./el-popover-CzPz6YOE.js";import{E as Be}from"./el-button-DNj5ad6N.js";import{E as Fe,a as $e}from"./el-radio-D-SFzlxi.js";import{p as P,r as f,c as V,w as l,o as _,b as U,a,d as s,j as L,L as q,t as y,i as h,k as Z,u as ue,z as S,F as De}from"./app-rUP0WFHc.js";import{_ as Ie}from"./BackendLayout-CVPXA1cN.js";import"./index-D1AOqHMa.js";import{l as me}from"./vue-draggable-plus-DD6EI5HZ.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                        */import{E as Me}from"./index-BMrvmh7r.js";import{E as je}from"./index-C2tRIJKK.js";import{a as Pe,E as Le}from"./index-CrKXfINh.js";import"./vnode-C-uRYfLb.js";import"./icon-HjsV8w-5.js";import"./refs-C5awHzNN.js";import"./index-CTujAvOj.js";import"./get-Bq4Kqk5y.js";import"./isArray-Dxzbedgu.js";import"./event-BB_Ol6Sd.js";import"./aria-CAJK2HN2.js";import"./use-form-common-props-BeLgxl5I.js";import"./index-CR5GapiV.js";import"./typescript-Bp3YSIOJ.js";import"./isEqual-nt7ctgGs.js";import"./_Uint8Array-CHYqkzCa.js";import"./index-C9IVSUvu.js";import"./castArray-Ce6QuK0j.js";import"./index-B2iIRy8e.js";import"./index-CzXl0CR-.js";import"./_initCloneObject-DgXXankK.js";import"./el-main-dkI-bN8J.js";import"./Header-BmWDgAAb.js";import"./el-avatar-D50oI0pS.js";import"./index-BrGes_xZ.js";import"./index-Dw169JbW.js";import"./_baseClone-DZbmGIMq.js";const qe={class:"min-h-full"},Ze={style:{margin:"10px 0 15px"}},He={key:0},Je={key:0},Ke={key:0},Qe={key:1},We={class:"example-pagination-block"},Xe={key:0},el={key:0},ll={key:0},al={key:1},tl={key:0},ol={class:"new_sub_row"},rl={__name:"Category",props:{category:Object},setup(fe){const b=P({...fe.category}),pe=f(!1),_e=f(!1),i={CATEGORY:"cat",SUBCATEGORY:"sub"},F=f(!1),Q=f(),C=f(),W=f(null),ve=o=>{F.value=!F.value,Q.value="類別 : "+o.name,C.value=o.subcategories,W.value=o.id,oe()},R=f(!1),X=o=>{switch(o){case i.CATEGORY:A.value=!A.value;break;case i.SUBCATEGORY:R.value=!R.value;break}},ee=(o,e)=>{let r=e===i.SUBCATEGORY?C.value:b.data;const v=o.oldIndex,p=o.newIndex,n=Math.min(v,p),m=Math.max(v,p),u=r.slice(n,m+1);u.forEach((Y,M)=>{Y.order_index=n+M+1}),ge(u,e)},ge=async(o,e)=>{switch(e){case i.CATEGORY:try{const r=await S.post("/back/categories/reorder",o)}catch{}break;case i.SUBCATEGORY:try{const r=await S.post("/back/subcategories/reorder",o)}catch{}break}},A=f(!1),O=f(!1),z=f(!1),g=f(null),w=f(null),x=f({}),T=f({}),le=async(o,e)=>{(e===i.CATEGORY?w.value===o.id:g.value===o.id)?await ce(o,e):ye(o,e)},ce=async(o,e)=>{try{switch(e){case i.CATEGORY:await ae(T.value,o,e);break;case i.SUBCATEGORY:await ae(x.value,o,e);break}}catch{}},ye=(o,e)=>{switch(e){case i.CATEGORY:w.value=o.id,T.value={...o};break;case i.SUBCATEGORY:g.value=o.id,x.value={...o};break}},ae=async(o,e,r)=>{switch(r){case i.CATEGORY:try{if(!Object.keys(o).some(u=>o[u]!==e[u])){w.value=null;return}await J(ne);let p={name:o.name,search_key:o.search_key,show_in_list:o.show_in_list,order_index:o.order_index},n=o.id;if((await S.patch(`/back/categories/${n}`,p)).data){Object.assign(e,o),w.value=null,c("success","保存成功");return}else throw c("error","保存失敗"),new Error("保存失敗")}catch{c("error","保存失敗")}break;case i.SUBCATEGORY:try{if(!Object.keys(o).some(u=>o[u]!==e[u])){g.value=null;return}await J(se);let p=e.id,n={category_id:o.category_id,name:o.name,search_key:o.search_key,show_in_list:o.show_in_list,order_index:o.order_index};if((await S.post(`/back/subcategories/${p}/update_sub`,n)).data){Object.assign(e,o),g.value=null,c("success","保存成功");return}else throw c("error","保存失敗"),new Error("保存失敗")}catch{c("error","保存失敗")}break}},te=async(o,e)=>{try{const{url:r,list:v,setList:p,errorMessages:n}=we(e),m=await S.delete(`${r}/${o}`);m.data.message==="success"?(p(v.filter(u=>u.id!==o)),c("success","刪除成功")):m.data.message===n.exist?c("error","關聯之子類別尚存在"):c("error","刪除失敗")}catch{c("error","刪除失敗")}},we=o=>{switch(o){case i.CATEGORY:return{url:"/back/categories",list:b.data,setList:e=>b.data=e,errorMessages:{exist:"subcategory exist"}};case i.SUBCATEGORY:return{url:"/back/subcategories",list:C.value,setList:e=>C.value=e,errorMessages:{}};default:throw new Error("未知的刪除類型")}},ke=()=>{g.value=null},k=P({name:"",search_key:"",show_in_list:"",order_index:""}),H=f("top"),be=()=>{const o=C.value.length>0?Math.max(...C.value.map(e=>e.order_index)):0;Object.assign(k,{name:"",search_key:"",show_in_list:1,order_index:o+1}),O.value=!O.value,z.value=!z.value},oe=()=>{z.value=null,O.value=!1,D.value&&D.value.resetFields()},G=f(!1),Ce=()=>{G.value=!G.value,I.value&&I.value.resetFields()},re=async o=>{try{const e=o===i.CATEGORY,r=e?I:D,v=e?{name:E.name,search_key:E.search_key,show_in_list:E.show_in_list}:{name:k.name,search_key:k.search_key,show_in_list:k.show_in_list},p=e?"/back/categories":`/back/categories/${W.value}/subcategories`,n=e?b.data:C.value;await J(r);const m=await S.post(p,v),u=e?m.data:m.data.data;u?(n.push(u),e?G.value=!1:(z.value=null,O.value=!O.value),c("success","新增成功")):c("error","新增失敗")}catch{c("error","新增失敗")}},Ee=()=>{w.value=null},$=f({}),c=(o,e)=>{Me({type:o,title:e,position:"bottom-left"})},D=f(null),I=f(null),se=f(null),ne=f(null),E=P({name:"",search_key:"",show_in_list:"",order_index:""}),Ve=()=>{G.value=!1},N=P({name:[{required:!0,message:"子類別名稱為必填項",trigger:"blur"}],search_key:[{required:!0,message:"索引名稱為必填項",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"索引名稱只能包含字母、數字或底線",trigger:"change"}],show_in_list:[{required:!0,message:"必須選擇顯示/隱藏",trigger:"change"}]}),J=o=>new Promise((e,r)=>{o.value?o.value.validate(v=>{v?e(!0):r(!1)}):r(new Error("未綁定"))});function xe(o){o=data.current_page,De.get("/back/categories",{page:o})}return(o,e)=>{const r=Be,v=Ge,p=je,n=Pe,m=Ye,u=Fe,Y=$e,M=ze,ie=Se,j=Le,Te=Ae,B=Ue,he=Re,de=Oe;return _(),V(Ie,null,{switch:l(()=>[U("div",qe,[U("div",Ze,[a(r,{onClick:Ce},{default:l(()=>e[23]||(e[23]=[s("添加類別")])),_:1}),a(v,{class:"box-item",effect:"dark",content:A.value===!1?"進行拖曳表格調整":"結束拖曳表格調整",placement:"top-start"},{default:l(()=>[L(a(r,{onClick:e[0]||(e[0]=t=>X(i.CATEGORY)),type:A.value===!1?"":"primary"},{default:l(()=>[s(y(A.value===!1?"調整順序":"退出調整"),1)]),_:1},8,["type"]),[[q,!O.value]])]),_:1},8,["content"])]),a(ue(me),{modelValue:b.data,"onUpdate:modelValue":e[4]||(e[4]=t=>b.data=t),target:"tbody",onEnd:e[5]||(e[5]=t=>ee(t,i.CATEGORY)),animation:150,ghostClass:"ghost",disabled:!A.value},{default:l(()=>[a(j,{model:T.value,rules:N,ref_key:"cgFormRef",ref:ne},{default:l(()=>[a(ie,{data:b.data,style:{width:"100%"},border:""},{default:l(()=>[a(m,{width:"220",fixed:_e.value?"left":!1,prop:"name"},{header:l(()=>e[24]||(e[24]=[s(" 類別名稱 ")])),default:l(t=>[w.value!==t.row.id?(_(),h("div",He,y(t.row.name),1)):(_(),V(n,{key:1,prop:"name"},{default:l(()=>[a(p,{modelValue:T.value.name,"onUpdate:modelValue":e[1]||(e[1]=d=>T.value.name=d),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1},8,["fixed"]),a(m,{prop:"search_key",label:"類別索引"},{header:l(()=>e[25]||(e[25]=[s(" 類別索引 ")])),default:l(t=>[w.value!==t.row.id?(_(),h("div",Je,y(t.row.search_key),1)):(_(),V(n,{key:1,prop:"search_key"},{default:l(()=>[a(p,{modelValue:T.value.search_key,"onUpdate:modelValue":e[2]||(e[2]=d=>T.value.search_key=d),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1}),a(m,{prop:"order_index",label:"順序"}),a(m,{prop:"show_in_list",label:"顯示 / 隱藏"},{default:l(t=>[w.value!==t.row.id?(_(),h("div",Ke,y(t.row.show_in_list==1?"顯示":"隱藏"),1)):(_(),h("div",Qe,[a(n,null,{default:l(()=>[a(Y,{modelValue:T.value.show_in_list,"onUpdate:modelValue":e[3]||(e[3]=d=>T.value.show_in_list=d)},{default:l(()=>[a(u,{value:1},{default:l(()=>e[26]||(e[26]=[s("顯示")])),_:1}),a(u,{value:0},{default:l(()=>e[27]||(e[27]=[s("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1})]))]),_:1}),a(m,{width:"140",fixed:pe.value?"right":!1},{header:l(()=>e[28]||(e[28]=[U("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[U("span",null,"子類別")],-1)])),default:l(t=>[a(r,{type:"primary",text:"",onClick:d=>ve(t.row)},{default:l(()=>e[29]||(e[29]=[s("查看")])),_:2},1032,["onClick"])]),_:1},8,["fixed"]),a(m,{label:"操作",width:"200"},{default:l(t=>[a(r,{type:w.value===t.row.id?"primary":"",size:"small",onClick:d=>le(t.row,i.CATEGORY)},{default:l(()=>[s(y(w.value===t.row.id?"儲存":"編輯"),1)]),_:2},1032,["type","onClick"]),w.value===t.row.id?(_(),V(r,{key:0,size:"small",onClick:Ee},{default:l(()=>e[30]||(e[30]=[s(" 取消 ")])),_:1})):Z("",!0),w.value!==t.row.id?(_(),V(M,{key:1,title:"確定移除此筆資料?",onConfirm:d=>te(t.row.id,i.CATEGORY),width:170,"hide-after":100,visible:$.value[t.row.id],"onUpdate:visible":d=>$.value[t.row.id]=d},{reference:l(()=>[a(r,{size:"small",type:"danger"},{default:l(()=>e[31]||(e[31]=[s("移除")])),_:1})]),actions:l(({confirm:d,cancel:K})=>[a(r,{size:"small",onClick:K},{default:l(()=>e[32]||(e[32]=[s("沒有")])),_:2},1032,["onClick"]),a(r,{type:"danger",size:"small",onClick:d},{default:l(()=>e[33]||(e[33]=[s(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])):Z("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","disabled"]),U("div",We,[e[34]||(e[34]=U("div",{class:"example-demonstration"},null,-1)),a(Te,{layout:"prev, pager, next",total:b.total,"page-size":b.per_page,"current-page":b.current_page,"onUpdate:currentPage":e[6]||(e[6]=t=>b.current_page=t),onCurrentChange:xe,background:""},null,8,["total","page-size","current-page"])])]),a(de,{modelValue:F.value,"onUpdate:modelValue":e[17]||(e[17]=t=>F.value=t),title:Q.value,width:"1000px"},{default:l(()=>[a(ue(me),{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value=t),target:"tbody",onEnd:e[11]||(e[11]=t=>ee(t,i.SUBCATEGORY)),animation:150,ghostClass:"ghost",disabled:!R.value},{default:l(()=>[a(j,{model:x.value,rules:N,ref_key:"subFormRef",ref:se},{default:l(()=>[a(ie,{data:C.value,style:{width:"100%"}},{default:l(()=>[a(m,{label:"子類別名稱",width:"220"},{default:l(t=>[g.value!==t.row.id?(_(),h("div",Xe,y(t.row.name),1)):(_(),V(n,{key:1,prop:"name"},{default:l(()=>[a(p,{modelValue:x.value.name,"onUpdate:modelValue":e[7]||(e[7]=d=>x.value.name=d),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1}),a(m,{label:"索引名稱",width:"220"},{default:l(t=>[g.value!==t.row.id?(_(),h("div",el,y(t.row.search_key),1)):(_(),V(n,{key:1,prop:"search_key"},{default:l(()=>[a(p,{modelValue:x.value.search_key,"onUpdate:modelValue":e[8]||(e[8]=d=>x.value.search_key=d),placeholder:"輸入索引名稱",size:"small"},null,8,["modelValue"])]),_:1}))]),_:1}),a(m,{label:"顯示 / 隱藏",width:"220"},{default:l(t=>[g.value!==t.row.id?(_(),h("div",ll,y(t.row.show_in_list==1?"顯示":"隱藏"),1)):(_(),h("div",al,[a(n,null,{default:l(()=>[a(Y,{modelValue:x.value.show_in_list,"onUpdate:modelValue":e[9]||(e[9]=d=>x.value.show_in_list=d)},{default:l(()=>[a(u,{value:1},{default:l(()=>e[35]||(e[35]=[s("顯示")])),_:1}),a(u,{value:0},{default:l(()=>e[36]||(e[36]=[s("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1})]))]),_:1}),a(m,{label:"順序",width:"108"},{default:l(t=>[g.value!==t.row.id?(_(),h("div",tl,y(t.row.order_index),1)):(_(),V(n,{key:1},{default:l(()=>[s(y(t.row.order_index),1)]),_:2},1024))]),_:1}),a(m,{label:"操作",width:"200"},{default:l(t=>[a(r,{type:g.value===t.row.id?"primary":"",size:"small",onClick:d=>le(t.row,i.SUBCATEGORY)},{default:l(()=>[s(y(g.value===t.row.id?"儲存":"編輯"),1)]),_:2},1032,["type","onClick"]),g.value===t.row.id?(_(),V(r,{key:0,size:"small",onClick:ke},{default:l(()=>e[37]||(e[37]=[s(" 取消 ")])),_:1})):Z("",!0),g.value!==t.row.id?(_(),V(M,{key:1,title:"確定移除此筆資料?",onConfirm:d=>te(t.row.id,i.SUBCATEGORY),width:170,"hide-after":100,visible:$.value[t.row.id],"onUpdate:visible":d=>$.value[t.row.id]=d},{reference:l(()=>[a(r,{size:"small",type:"danger"},{default:l(()=>e[38]||(e[38]=[s("移除")])),_:1})]),actions:l(({confirm:d,cancel:K})=>[a(r,{size:"small",onClick:K},{default:l(()=>e[39]||(e[39]=[s("沒有")])),_:2},1032,["onClick"]),a(r,{type:"danger",size:"small",onClick:d},{default:l(()=>e[40]||(e[40]=[s(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])):Z("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","disabled"]),L(U("div",ol,[a(j,{model:k,rules:N,ref_key:"newSubFormRef",ref:D},{default:l(()=>[a(he,{class:"new_sub_form_row"},{default:l(()=>[a(B,null,{default:l(()=>[a(n,{prop:"name"},{default:l(()=>[a(p,{modelValue:k.name,"onUpdate:modelValue":e[12]||(e[12]=t=>k.name=t),placeholder:"輸入子類別",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),a(B,null,{default:l(()=>[a(n,{prop:"search_key"},{default:l(()=>[a(p,{modelValue:k.search_key,"onUpdate:modelValue":e[13]||(e[13]=t=>k.search_key=t),placeholder:"輸入索引名稱",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),a(B,null,{default:l(()=>[a(n,null,{default:l(()=>[a(Y,{modelValue:k.show_in_list,"onUpdate:modelValue":e[14]||(e[14]=t=>k.show_in_list=t)},{default:l(()=>[a(u,{value:1},{default:l(()=>e[41]||(e[41]=[s("顯示")])),_:1}),a(u,{value:0},{default:l(()=>e[42]||(e[42]=[s("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(B,null,{default:l(()=>[a(n,null,{default:l(()=>[s(y(k.order_index),1)]),_:1})]),_:1}),a(B,null,{default:l(()=>[a(n,null,{default:l(()=>[a(r,{size:"small",type:"success",onClick:e[15]||(e[15]=t=>re(i.SUBCATEGORY))},{default:l(()=>e[43]||(e[43]=[s(" 新增 ")])),_:1}),a(r,{size:"small",onClick:oe},{default:l(()=>e[44]||(e[44]=[s(" 取消 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])],512),[[q,z.value]]),L(a(r,{style:{margin:"10px 0"},onClick:be},{default:l(()=>e[45]||(e[45]=[s("添加子類別")])),_:1},512),[[q,!O.value]]),a(v,{class:"box-item",effect:"dark",content:R.value===!1?"進行拖曳表格調整":"結束拖曳表格調整",placement:"top-start"},{default:l(()=>[L(a(r,{style:{margin:"10px"},onClick:e[16]||(e[16]=t=>X(i.SUBCATEGORY)),type:R.value===!1?"":"primary"},{default:l(()=>[s(y(R.value===!1?"調整順序":"退出調整"),1)]),_:1},8,["type"]),[[q,!O.value]])]),_:1},8,["content"])]),_:1},8,["modelValue","title"]),a(de,{modelValue:G.value,"onUpdate:modelValue":e[22]||(e[22]=t=>G.value=t),title:"新增類別",width:"400px"},{footer:l(()=>[a(r,{type:"primary",onClick:e[21]||(e[21]=t=>re(i.CATEGORY))},{default:l(()=>e[48]||(e[48]=[s("提交")])),_:1}),a(r,{onClick:Ve},{default:l(()=>e[49]||(e[49]=[s("取消")])),_:1})]),default:l(()=>[a(j,{model:E,class:"demo-ruleForm",rules:N,ref_key:"newCgFormRef",ref:I},{default:l(()=>[a(n,{label:"類別名稱","label-position":H.value,prop:"name"},{default:l(()=>[a(p,{modelValue:E.name,"onUpdate:modelValue":e[18]||(e[18]=t=>E.name=t)},null,8,["modelValue"])]),_:1},8,["label-position"]),a(n,{label:"索引名稱","label-position":H.value,prop:"search_key"},{default:l(()=>[a(p,{modelValue:E.search_key,"onUpdate:modelValue":e[19]||(e[19]=t=>E.search_key=t)},null,8,["modelValue"])]),_:1},8,["label-position"]),a(n,{label:"顯示 / 隱藏","label-position":H.value,prop:"show_in_list"},{default:l(()=>[a(Y,{modelValue:E.show_in_list,"onUpdate:modelValue":e[20]||(e[20]=t=>E.show_in_list=t)},{default:l(()=>[a(u,{value:1},{default:l(()=>e[46]||(e[46]=[s("顯示")])),_:1}),a(u,{value:0},{default:l(()=>e[47]||(e[47]=[s("隱藏")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-position"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1})}}},aa=Ne(rl,[["__scopeId","data-v-43e0f415"]]);export{aa as default};
