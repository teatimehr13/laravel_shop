import{E as K}from"./base-iHJmQtcg.js";/* empty css                     */import{E as W}from"./el-date-picker-FaBY5tv7.js";/* empty css                 */import"./el-scrollbar-BLZesUDu.js";import"./el-popper-CJSoZX_d.js";import{E as X}from"./el-button-CQNoZzvE.js";import{E as Z}from"./el-overlay-CtzYCaxC.js";import{g as k,E as ee}from"./el-progress-Bfxy5kti.js";import{E as te,a as oe}from"./el-radio-1sMkJyS3.js";import"./el-tag-CPuyrTQm.js";import{E as le,a as ae}from"./el-select-7TH_FEuU.js";import{p as q,r as _,h as R,i as $,a as o,b as g,w as i,N as B,F as ie,o as E,d as f,O as se,c as re}from"./app-JKzr_vVp.js";import{H as ne}from"./Header-DYfxgUL-.js";import{p as C}from"./purify.es-pRVhHGEY.js";/* empty css                        */import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as de}from"./index-DSWjJ9cE.js";import{E as ue,a as me}from"./index-DJdM4qGV.js";import{E as ce}from"./index-CcXRvPvX.js";import"./dayjs.min-Dd8mipII.js";import"./use-form-common-props-CZDNuDUm.js";import"./get-BNOfz7a2.js";import"./isArray-Dxzbedgu.js";import"./index-Cl32T4Tj.js";import"./aria-CHApNzmi.js";import"./index-CL1ggOOL.js";import"./index-CSTan3Pl.js";import"./index-LrBu9EIq.js";import"./index-Cz3lXVSV.js";import"./index-BLed4XWL.js";import"./index-CM0LdUiu.js";import"./isEqual-ZMkI4w92.js";import"./_Uint8Array-CSMkYC73.js";import"./icon-MSFJ_NKx.js";import"./vnode-B6PzXlGy.js";import"./refs-Dd4dlhR7.js";import"./event-BB_Ol6Sd.js";import"./typescript-Bp3YSIOJ.js";import"./_baseClone-Cky5vQQ9.js";import"./_initCloneObject-32_YsKBG.js";import"./castArray-Ce6QuK0j.js";import"./el-col-Db_ElxR5.js";import"./el-avatar-B4DVVCcp.js";const ge={class:""},_e={class:"max-w-[1440px] mx-auto px-4 bg-white"},fe={class:"py-8"},be={class:"max-w-[1440px] mx-auto px-4 bg-white"},ve={class:"mx-2.5"},ye=["src"],we={__name:"Edit",props:{product:Object,subcategories:Array},setup(I){const x=I,t=q({...x.product}),p=_("top"),d=_([]);d.value=t.image?[{name:t.name,url:t.image,uid:k()}]:[];const V=_(""),b=_(!1),v=_([]),N=l=>{V.value=l.url,b.value=!0},O=l=>{d.value=[{name:l.name,url:l.url,uid:l.uid,raw:l.raw}]},P=(l,e)=>{d.value=[]},j=l=>{v.value.clearFiles();const e=l[0];e.uid=k(),v.value.handleStart(e)},L=q({name:[{required:!0,message:"產品名稱必填項",trigger:"blur"}],title:[{required:!0,message:"產品title為必填項",trigger:"submit"}],price:[{required:!0,message:"售價必填項",trigger:"submit"}],subcategory_id:[{required:!0,message:"子類別為必填項",trigger:"blur"}],published_status:[{required:!0,message:"請選擇顯示或隱藏",trigger:"submit"}],image:[{validator:(l,e,r)=>{var m;if(!d.value||d.value.length===0)return r();const u=(m=d.value[0])==null?void 0:m.raw;if(!u)return r();if(!["image/jpeg","image/png","image/gif"].includes(u.type))return r(new Error("圖片格式僅限 jpg/png/gif"));r()},trigger:"change"}],category_id:[{required:!0,message:"此選項為必填",trigger:"blur"}],special_start_at:[{type:"date",required:!1,message:"請選擇開始時間",trigger:"change"}],special_end_at:[{type:"date",required:!1,message:"請選擇結束時間",trigger:"change"},{validator:(l,e,r)=>{if(!e||!t.special_start_at)return r();const u=new Date(t.special_start_at);new Date(e)<u?r(new Error("結束時間需晚於開始時間")):r()},trigger:"change"}]}),y=_(null),M=async()=>{if(!y.value)throw new Error("internalFormRef 未綁定");return await y.value.validate()};let s=new FormData;const T=()=>{s=new FormData;const l=C.sanitize(t.description),e=C.sanitize(t.special_message);s.append("name",t.name),s.append("title",t.title),s.append("price",t.price),s.append("subcategory_id",t.subcategory_id),s.append("published_status",t.published_status),s.append("description",l),s.append("special_message",e),s.append("special_start_at",h(t.special_start_at)||""),s.append("special_end_at",h(t.special_end_at)||"");for(const[r,u]of s.entries());if(d.value.length>0){const r=d.value[0];r.raw&&s.append("image",r.raw)}else s.append("delete_image",!0);return s},A=async()=>{try{await M(),await T(),s.append("_method","PATCH");const e=(await axios.post(`/back/products/${t.id}`,s,{headers:{"Content-Type":"multipart/form-data"}})).data;if(e){Object.assign(t,e),D("success","保存成功");return}}catch{D("error","保存失敗")}};function h(l){if(!l)return null;let e;if(l instanceof Date)e=l;else if(typeof l=="string"){if(e=new Date(l),isNaN(e))return null}else return null;const r=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),m=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),w=String(e.getSeconds()).padStart(2,"0");return`${r}-${u}-${c} ${m}:${n}:${w}`}const D=(l,e)=>{de({type:l,title:e,position:"bottom-left"})};function H(){ie.visit("/back/products")}return(l,e)=>{const r=R("ArrowLeft"),u=K,c=X,m=ce,n=me,w=le,Q=ae,F=te,z=oe,G=ee,Y=Z,S=R("QuillEditor"),U=W,J=ue;return E(),$(B,null,[o(ne),g("main",ge,[g("div",_e,[g("p",fe,[o(c,{link:"",onClick:H,class:"hover:underline px-2 py-1"},{default:i(()=>[o(u,null,{default:i(()=>[o(r)]),_:1}),e[10]||(e[10]=f(" 回上一頁 "))]),_:1})])]),g("div",be,[g("div",ve,[o(J,{model:t,"label-width":"300px",class:"demo-ruleForm",rules:L,ref_key:"internalFormRef",ref:y},{default:i(()=>[o(n,{label:"產品名稱","label-position":p.value,prop:"name"},{default:i(()=>[o(m,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"產品title","label-position":p.value,prop:"title"},{default:i(()=>[o(m,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"價格","label-position":p.value,prop:"title"},{default:i(()=>[o(m,{modelValue:t.price,"onUpdate:modelValue":e[2]||(e[2]=a=>t.price=a),style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"子類別","label-position":p.value,prop:"subcategory_id"},{default:i(()=>[o(Q,{modelValue:t.subcategory_id,"onUpdate:modelValue":e[3]||(e[3]=a=>t.subcategory_id=a),modelModifiers:{number:!0},teleported:!1,style:{"max-width":"300px"}},{default:i(()=>[(E(!0),$(B,null,se(x.subcategories,a=>(E(),re(w,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"操作","label-position":p.value,prop:"published_status"},{default:i(()=>[o(z,{modelValue:t.published_status,"onUpdate:modelValue":e[4]||(e[4]=a=>t.published_status=a)},{default:i(()=>[o(F,{value:1},{default:i(()=>e[11]||(e[11]=[f("上架")])),_:1}),o(F,{value:0},{default:i(()=>e[12]||(e[12]=[f("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"圖片","label-position":p.value,prop:"image"},{default:i(()=>[o(G,{"file-list":d.value,class:"upload-demo",action:"","on-preview":N,"on-remove":P,"list-type":"picture","auto-upload":!1,limit:1,"on-exceed":j,ref_key:"upload",ref:v,"popper-class":"no-transition","on-change":O},{default:i(()=>[o(c,{type:""},{default:i(()=>e[13]||(e[13]=[f("選擇檔案")])),_:1})]),_:1},8,["file-list"]),o(Y,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a)},{default:i(()=>[g("img",{"w-full":"",src:V.value,alt:"Preview Image",style:{margin:"auto"}},null,8,ye)]),_:1},8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"產品描述","label-position":p.value,prop:"description",class:"quill-item"},{default:i(()=>[o(S,{content:t.description,"onUpdate:content":e[6]||(e[6]=a=>t.description=a),"content-type":"html",theme:"snow",ref:"quillRef",style:{"min-height":"200px"}},null,8,["content"])]),_:1},8,["label-position"]),e[14]||(e[14]=g("hr",{style:{margin:"10px auto"}},null,-1)),o(n,{label:"特惠訊息","label-position":p.value,prop:"special_message",class:"quill-item"},{default:i(()=>[o(S,{content:t.special_message,"onUpdate:content":e[7]||(e[7]=a=>t.special_message=a),"content-type":"html",theme:"snow",ref:"specialQuillRef",style:{"min-height":"200px"}},null,8,["content"])]),_:1},8,["label-position"]),o(n,{label:"特惠時間","label-position":p.value,prop:"special_start_at"},{default:i(()=>[o(U,{modelValue:t.special_start_at,"onUpdate:modelValue":e[8]||(e[8]=a=>t.special_start_at=a),type:"datetime",placeholder:"開始時間",teleported:!1,style:{"margin-right":"10px"}},null,8,["modelValue"])]),_:1},8,["label-position"]),o(n,{label:"","label-position":p.value,prop:"special_end_at"},{default:i(()=>[o(U,{modelValue:t.special_end_at,"onUpdate:modelValue":e[9]||(e[9]=a=>t.special_end_at=a),type:"datetime",placeholder:"結束時間",teleported:!1},null,8,["modelValue"])]),_:1},8,["label-position"])]),_:1},8,["model","rules"])]),o(c,{class:"mx-2.5 mb-4",type:"primary",onClick:A},{default:i(()=>e[15]||(e[15]=[f(" 提交 ")])),_:1})])])],64)}}},mt=pe(we,[["__scopeId","data-v-f40f95c0"]]);export{mt as default};
