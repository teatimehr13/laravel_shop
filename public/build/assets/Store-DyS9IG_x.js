import{b as Be,u as $e,_ as Ae,c as Ie,w as ze}from"./base-DdF9LHzb.js";import{v as He}from"./el-loading-CQhoibzd.js";import{E as Me}from"./el-overlay-BtrBO0B-.js";import{E as Oe,a as Ke}from"./el-table-column-BUbEU7oj.js";import{E as je}from"./el-checkbox-XIduAFHh.js";import"./el-tooltip-l0sNRNKZ.js";import{b as le,u as w,E as ce}from"./el-popper-B0TJAX3S.js";import"./el-scrollbar-D-M4snyz.js";import{E as We}from"./el-popover-CzPz6YOE.js";import{E as Ye}from"./el-button-DNj5ad6N.js";/* empty css                     */import"./el-tag-Ch_t78t2.js";/* empty css                 */import{E as qe,a as Xe}from"./el-select-vY8immTa.js";import{av as Ge,C as ve,f as L,r as s,u,R as Je,o as R,c as Y,w as n,i as q,n as be,t as ne,k as X,A as se,d as g,a4 as Qe,y as Ze,p as j,z as A,g as ie,aw as et,b as h,a as l,O as tt,N as ot,P as at,j as rt,W as pe,X as lt}from"./app-rUP0WFHc.js";import{_ as nt}from"./BackendLayout-CVPXA1cN.js";import de from"./StoreForm-Du3m9Ta7.js";import{d as ue}from"./index-D1AOqHMa.js";/* empty css                        */import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as it}from"./el-progress-OMZRB744.js";import{E as pt}from"./index-C2tRIJKK.js";import{a as dt}from"./index-CrKXfINh.js";import{d as W}from"./el-avatar-D50oI0pS.js";import{E as me}from"./index-BMrvmh7r.js";import"./aria-CAJK2HN2.js";import"./index-CTujAvOj.js";import"./get-Bq4Kqk5y.js";import"./isArray-Dxzbedgu.js";import"./use-form-common-props-BeLgxl5I.js";import"./index-CR5GapiV.js";import"./vnode-C-uRYfLb.js";import"./icon-HjsV8w-5.js";import"./refs-C5awHzNN.js";import"./event-BB_Ol6Sd.js";import"./_Uint8Array-CHYqkzCa.js";import"./index-C9IVSUvu.js";import"./_initCloneObject-DgXXankK.js";import"./isEqual-nt7ctgGs.js";import"./index-CzXl0CR-.js";import"./castArray-Ce6QuK0j.js";import"./index-B2iIRy8e.js";import"./el-main-dkI-bN8J.js";import"./Header-BmWDgAAb.js";import"./el-col-CWY6KSpn.js";import"./typescript-Bp3YSIOJ.js";import"./index-BrGes_xZ.js";import"./el-radio-D-SFzlxi.js";import"./_baseClone-DZbmGIMq.js";import"./index-Dw169JbW.js";const ut=Be({trigger:le.trigger,placement:W.placement,disabled:le.disabled,visible:w.visible,transition:w.transition,popperOptions:W.popperOptions,tabindex:W.tabindex,content:w.content,popperStyle:w.popperStyle,popperClass:w.popperClass,enterable:{...w.enterable,default:!0},effect:{...w.effect,default:"light"},teleported:w.teleported,title:String,width:{type:[String,Number],default:150},offset:{type:Number,default:void 0},showAfter:{type:Number,default:0},hideAfter:{type:Number,default:200},autoClose:{type:Number,default:0},showArrow:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},"onUpdate:visible":{type:Function}}),mt={"update:visible":c=>Ge(c),"before-enter":()=>!0,"before-leave":()=>!0,"after-enter":()=>!0,"after-leave":()=>!0},ft="onUpdate:visible",ct=ve({name:"ElPopover"}),vt=ve({...ct,props:ut,emits:mt,setup(c,{expose:f,emit:v}){const o=c,p=L(()=>o[ft]),b=$e("popover"),y=s(),x=L(()=>{var r;return(r=u(y))==null?void 0:r.popperRef}),F=L(()=>[{width:Je(o.width)},o.popperStyle]),P=L(()=>[b.b(),o.popperClass,{[b.m("plain")]:!!o.content}]),T=L(()=>o.transition===`${b.namespace.value}-fade-in-linear`),D=()=>{var r;(r=y.value)==null||r.hide()},N=()=>{v("before-enter")},I=()=>{v("before-leave")},z=()=>{v("after-enter")},E=()=>{v("update:visible",!1),v("after-leave")};return f({popperRef:x,hide:D}),(r,G)=>(R(),Y(u(ce),Qe({ref_key:"tooltipRef",ref:y},r.$attrs,{trigger:r.trigger,placement:r.placement,disabled:r.disabled,visible:r.visible,transition:r.transition,"popper-options":r.popperOptions,tabindex:r.tabindex,content:r.content,offset:r.offset,"show-after":r.showAfter,"hide-after":r.hideAfter,"auto-close":r.autoClose,"show-arrow":r.showArrow,"aria-label":r.title,effect:r.effect,enterable:r.enterable,"popper-class":u(P),"popper-style":u(F),teleported:r.teleported,persistent:r.persistent,"gpu-acceleration":u(T),"onUpdate:visible":u(p),onBeforeShow:N,onBeforeHide:I,onShow:z,onHide:E}),{content:n(()=>[r.title?(R(),q("div",{key:0,class:be(u(b).e("title")),role:"title"},ne(r.title),3)):X("v-if",!0),se(r.$slots,"default",{},()=>[g(ne(r.content),1)])]),default:n(()=>[r.$slots.reference?se(r.$slots,"reference",{key:0}):X("v-if",!0)]),_:3},16,["trigger","placement","disabled","visible","transition","popper-options","tabindex","content","offset","show-after","hide-after","auto-close","show-arrow","aria-label","effect","enterable","popper-class","popper-style","teleported","persistent","gpu-acceleration","onUpdate:visible"]))}});var bt=Ae(vt,[["__file","popover.vue"]]);const fe=(c,f)=>{const v=f.arg||f.value,o=v==null?void 0:v.popperRef;o&&(o.triggerRef=c)};var gt={mounted(c,f){fe(c,f)},updated(c,f){fe(c,f)}};const _t="popover",yt=Ie(gt,_t),wt=ze(bt,{directive:yt}),ht={class:"filters"},kt={style:{display:"flex","align-items":"center",gap:"8px"}},Ct=["src"],Et=["innerHTML"],St={style:{display:"flex","align-items":"center",gap:"8px"}},Ut={__name:"Store",setup(c){Ze(()=>{D(),Ee()});const f=t=>{d.value=t},v=[{name:"全部類型",value:""},{name:"直營",value:"0"},{name:"特約展售",value:"1"},{name:"授權經銷商",value:"2"}],o=j({store_name:"",store_type:"",address:"",contact_number:"",opening_hours:""}),p=j({data:[],current_page:1,last_page:null}),b=s(!1),y=s(!1),x=s(""),F=s(""),P=s(!1),T=s(!1),D=ue(async()=>{if(!(b.value||y.value)){b.value=!0;try{const t=await A.get("/back/stores",{params:{page:p.current_page,store_type:x.value||null,address:F.value||null}}),e=t.data.data,k=t.data.last_page;e.length>0?(p.data.push(...e),p.current_page+=1,p.last_page=k,p.current_page>p.last_page&&(y.value=!0)):y.value=!0}catch{}finally{b.value=!1}}},300),N=ue(()=>{p.data=[],p.current_page=1,y.value=!1,D()},500),I=L(()=>p.data?p.data.map(t=>t.opening_hours?t.opening_hours.split(`
`).map(e=>e.trim()).filter(e=>e!=="").join("<br>"):""):""),z=({row:t})=>S.value===t.id?"activeRowFocus":"",E=j({}),r=s("left-start"),G=s(null),ge=s({});s("default");let _e=s(8);const ye=s({height:"550px",overflowX:"hidden",overflowY:"auto"}),J=t=>{E[t]=!1},S=s(null),we=t=>{setTimeout(()=>{V.value=t.image?[{name:t.store_name,url:t.image,uid:it()}]:[],d.value=[{delete_image:!1}],o.is_enabled=parseInt(t.is_enabled),o.id=t.id,o.store_name=t.store_name,o.store_type=parseInt(t.store_type),o.address=t.address,o.image=t.image,o.contact_number=t.contact_number,o.opening_hours=t.opening_hours?t.opening_hours.split(`
`).map(e=>e.trim()).filter(e=>e!=="").join(`
`):""},100)},he=t=>{ke()},ke=()=>{const t=document.querySelector(".el-scrollbar__wrap");t&&(t.style.overflowY="hidden")},Ce=()=>{const t=document.querySelector(".el-scrollbar__wrap");t&&(t.style.overflowY="auto")},Ee=()=>{const t=document.createElement("style");t.type="text/css",t.innerHTML=`
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #d3d3d3;
      border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #b3b3b3; /* 滾動條懸停顏色 */
    }
  `,document.head.appendChild(t)};s("");const U=s(!1),Q=()=>{U.value=!U.value,Se()},H=()=>{me({title:"操作成功",type:"success",position:"bottom-left"})},B=()=>{me({title:"操作失敗",type:"error",position:"bottom-left"})},V=s([]);let d=s([]);const M=s(null),Z=s(null),ee=t=>{switch(t){case"edit":return Z.value.formValidate();case"add":return M.value.formValidate()}},Se=()=>{lt(()=>{M.value.internalFormRef.resetFields(),o.store_name="",o.store_type="",o.address="",o.contact_number="",o.opening_hours="",o.is_enabled="",V.value=[],d.value=[]})};let m=new FormData;const te=()=>{if(m=new FormData,m.append("store_name",o.store_name),m.append("store_type",o.store_type),m.append("address",o.address),m.append("contact_number",o.contact_number),m.append("opening_hours",o.opening_hours),m.append("is_enabled",o.is_enabled),m.append("id",o.id),d.value.length>0){const t=d.value[0];t.raw&&m.append("image",t.raw)}else m.append("delete_image",!0)},O=s({}),oe=async()=>{try{await ee("edit"),await te();const e=(await A.post("/back/stores/update_stores",m,{headers:{"Content-Type":"multipart/form-data"}})).data;if(e){const k=p.data.findIndex($=>$.id===e.id);k!==-1&&(p.data[k]=e),J(o.id),H();return}B()}catch{}},Ue=async()=>{try{if(await ee("add"),await te(),(await A.post("/back/stores",m,{headers:{"Content-Type":"multipart/form-data"}})).data){U.value=!U.value,H();return}B()}catch{B()}},Ve=async t=>{try{let e={id:t};if((await A.post("/back/stores/delete_stores",e,{headers:{"Content-Type":"multipart/form-data"}})).data.success){p.data=p.data.filter(K=>K.id!==t),H();return}B()}catch{}};return ie(E,t=>{for(const e in t)if(t[e]){S.value=Number(e);return}S.value=""},{deep:!0}),ie(O,t=>{for(const e in t)if(t[e]){S.value=Number(e);return}S.value=""},{deep:!0}),(t,e)=>{const k=qe,$=Xe,K=pt,_=Ye,ae=je,re=ce,C=Oe,Le=dt,Re=wt,xe=We,Fe=Ke,Pe=Me,Te=et("el-table-infinite-scroll"),De=He;return R(),Y(nt,null,{switch:n(()=>[h("div",null,[h("div",ht,[l($,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"全部類型",style:{width:"150px"},onChange:u(N)},{default:n(()=>[(R(),q(ot,null,tt(v,a=>l(k,{key:a.value,label:a.name,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onChange"]),l(K,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=a=>F.value=a),placeholder:"輸入地址篩選",style:{width:"240px"},onKeyup:at(u(N),["enter"])},null,8,["modelValue","onKeyup"])]),l(_,{type:"",onClick:Q,style:{margin:"10px 0"}},{default:n(()=>e[11]||(e[11]=[g("新增門市")])),_:1}),h("div",null,[rt((R(),Y(Fe,{data:p.data,style:{width:"100%",height:"calc(100vh - 250px)"},"infinite-scroll-disabled":b.value,"element-loading-text":"加載中...","row-class-name":z,border:""},{default:n(()=>[l(C,{fixed:T.value?"left":!1,prop:"store_name"},{header:n(()=>[h("div",kt,[e[12]||(e[12]=h("span",null,"門市名稱",-1)),l(re,{content:"固定/取消固定門市列"},{default:n(()=>[l(ae,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a)},null,8,["modelValue"])]),_:1})])]),_:1},8,["fixed"]),l(C,{label:"圖片"},{default:n(a=>[a.row.image?(R(),q("img",{key:0,src:a.row.image,alt:"店面圖片",style:{"max-width":"75px","border-radius":"4px"}},null,8,Ct)):X("",!0)]),_:1}),l(C,{prop:"store_type_name",label:"類型"}),l(C,{prop:"address",label:"地址"}),l(C,{prop:"contact_number",label:"聯絡電話"}),l(C,{prop:"opening_hours",label:"營業時間"},{default:n(a=>[h("div",{innerHTML:I.value[a.$index]},null,8,Et)]),_:1}),l(C,{fixed:P.value?"right":!1},{header:n(()=>[h("div",St,[e[13]||(e[13]=h("span",null,"操作",-1)),l(re,{content:"固定/取消固定操作列"},{default:n(()=>[l(ae,{modelValue:P.value,"onUpdate:modelValue":e[3]||(e[3]=a=>P.value=a)},null,8,["modelValue"])]),_:1})])]),default:n(a=>[l(Re,{placement:r.value,trigger:"click",width:350,visible:E[a.row.id],"onUpdate:visible":i=>E[a.row.id]=i,"popper-class":"custom-scrollbar","hide-after":0,"show-after":100,onShow:i=>he(a.row.id),"popper-style":ye.value,onBeforeLeave:Ce,offset:u(_e),ref_key:"popoverRef",ref:G},{reference:n(()=>[l(_,{size:"small",onClick:i=>we(a.row),ref:i=>ge.value[a.row.id]=i,class:be({activeButton:S.value===a.row.id})},{default:n(()=>e[14]||(e[14]=[g("編輯")])),_:2},1032,["onClick","class"])]),default:n(()=>[l(de,{"file-list":V.value,"onUpdate:fileList":e[4]||(e[4]=i=>V.value=i),"form-data":o,"onUpdate:formData":e[5]||(e[5]=i=>o=i),onSubmit:oe,uploadList:u(d),"onUpdate:uploadList":e[6]||(e[6]=i=>pe(d)?d.value=i:d=i),ref_key:"formRef2",ref:Z,onUploadList:f},null,8,["file-list","form-data","uploadList"]),l(Le,null,{default:n(()=>[l(_,{type:"primary",onClick:oe},{default:n(()=>e[15]||(e[15]=[g("儲存")])),_:1}),l(_,{onClick:i=>J(a.row.id)},{default:n(()=>e[16]||(e[16]=[g("關閉")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["placement","visible","onUpdate:visible","onShow","popper-style","offset"]),l(xe,{title:"確定移除此筆資料?",onConfirm:i=>Ve(a.row.id),width:170,"hide-after":100,visible:O.value[a.row.id],"onUpdate:visible":i=>O.value[a.row.id]=i},{reference:n(()=>[l(_,{size:"small",type:"danger"},{default:n(()=>e[17]||(e[17]=[g("移除")])),_:1})]),actions:n(({confirm:i,cancel:Ne})=>[l(_,{size:"small",onClick:Ne},{default:n(()=>e[18]||(e[18]=[g("沒有")])),_:2},1032,["onClick"]),l(_,{type:"danger",size:"small",onClick:i},{default:n(()=>e[19]||(e[19]=[g(" 是 ")])),_:2},1032,["onClick"])]),_:2},1032,["onConfirm","visible","onUpdate:visible"])]),_:1},8,["fixed"])]),_:1},8,["data","infinite-scroll-disabled"])),[[Te,u(D)],[De,b.value]])])]),l(Pe,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),title:"新增",width:"400px"},{footer:n(()=>[l(_,{type:"primary",onClick:Ue},{default:n(()=>e[20]||(e[20]=[g("提交")])),_:1}),l(_,{onClick:Q},{default:n(()=>e[21]||(e[21]=[g("取消")])),_:1})]),default:n(()=>[l(de,{"form-data":o,"onUpdate:formData":e[7]||(e[7]=a=>o=a),"file-list":V.value,"onUpdate:fileList":e[8]||(e[8]=a=>V.value=a),"upload-list":u(d),"onUpdate:uploadList":e[9]||(e[9]=a=>pe(d)?d.value=a:d=a),onUploadList:f,ref_key:"formRef",ref:M},null,8,["form-data","file-list","upload-list"])]),_:1},8,["modelValue"])]),_:1})}}},Eo=st(Ut,[["__scopeId","data-v-c385a3f5"]]);export{Eo as default};
